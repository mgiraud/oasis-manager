import{_ as E,d as x,a as S,u as h,v as w,m as y,aq as C,p as b,q as I,P as D,ab as P,o as _,c as M,e as N,f as B,C as c,j as O}from"./entry-2e347780.mjs";import{u as k}from"./asyncData-bc25d67a.mjs";import{F as U}from"./FormComponent-db62320b.mjs";import"./Icon-f078fbba.mjs";import"./useDateHelper-e4869b7b.mjs";import"./FileManager-1a196688.mjs";import"./use-outside-click-ea4f1ee7.mjs";import"./transition-2ed963cb.mjs";import"./dialog-f417b9ae.mjs";import"./TextField-5fde64fb.mjs";import"./CheckboxField-48f65d1d.mjs";import"./Editor-dc6b4d69.mjs";import"./calculate-active-index-130b59fd.mjs";const A=x({async setup(f,{expose:r}){r();let i,e;const t=S(),p=h(),u=w(),s=y("page-edition",()=>null),m=C();[i,e]=b(async()=>k("async-page-edition",async()=>{await t.load(p.params.slug,{"groups[]":"page:read:edition"}),s.value=t[c.EDITION].retrieved})),await i,e();const l=I(),v=async(o,n)=>{o.isPublished==="true"&&(o.isPublished=!1),o.showInMenu==="true"&&(o.showInMenu=!1);try{await t.update(o.url,o),l.showMessage("Page correctement \xE9dit\xE9e")}catch{l.showError("Erreur dans la sauvegarde la page, v\xE9rifie le formulaire"),n.setErrors(t[c.Edition].violations)}};let a=null;const d=()=>{var o,n;m.create({originalContent:(o=s.value)==null?void 0:o.content,draft:!0,page:(n=s.value)==null?void 0:n["@id"]})};D(()=>{a=window.setInterval(d,12e4)}),P(()=>{a&&clearInterval(a),a=null});const g={pageStore:t,route:p,app:u,pageEdition:s,pageLogStore:m,notificationStore:l,submit:v,autoSaveInterval:a,autoSave:d,FormComponent:U,CRUD_MODE:c};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),F={class:"flex flex-col flex-auto p-3"},R=O("h1",{class:"mb-4"},"\xC9dition d'une page",-1);function j(f,r,i,e,t,p){return _(),M("div",F,[R,e.pageEdition?(_(),N(e.FormComponent,{key:0,page:e.pageEdition,"onUpdate:page":r[0]||(r[0]=u=>e.pageEdition=u),"submit-handler":e.submit,errors:e.pageStore[e.CRUD_MODE.EDITION].violations},null,8,["page","errors"])):B("",!0)])}var $=E(A,[["render",j]]);export{$ as default};
