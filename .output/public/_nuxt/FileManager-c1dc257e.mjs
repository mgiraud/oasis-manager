var je=Object.defineProperty,Ie=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var be=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var xe=(r,a,l)=>a in r?je(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l,H=(r,a)=>{for(var l in a||(a={}))Me.call(a,l)&&xe(r,l,a[l]);if(be)for(var l of be(a))Te.call(a,l)&&xe(r,l,a[l]);return r},le=(r,a)=>Ie(r,De(a));import{d as N,h as P,i as E,N as z,S as G,Q as fe,y as Ve,_ as j,r as ke,o as c,c as v,j as u,t as $,F as I,k as D,e as T,H as Q,p as me,D as He,b as x,g as W,f as U,ag as ae,P as Be,z as _e,w as M,I as ge,C as ue,U as $e,ah as Ue,n as Ae,E as Le,q as we}from"./entry-bbf0cde0.mjs";import{u as he}from"./asyncData-ab30f611.mjs";import{I as X}from"./Icon-ca36084c.mjs";import{t as ve,e as re,c as Re,u as ye,l as te,a as _,g as qe,k as Y,p as Ce,m as oe,H as R,d as A,o as B,L as de,T as pe,S as Ge,b as Ke}from"./use-outside-click-545a1624.mjs";import{b as ze,f as Qe,o as We}from"./transition-b8498542.mjs";import{r as ne,M as Xe,j as Ye,A as Ze}from"./dialog-082ab9cf.mjs";import{T as Se}from"./TextField-52f43e27.mjs";var Je=(r=>(r[r.Open=0]="Open",r[r.Closed=1]="Closed",r))(Je||{});let Pe=Symbol("PopoverContext");function ie(r){let a=G(Pe,null);if(a===null){let l=new Error(`<${r} /> is missing a parent <${Ee.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,ie),l}return a}let Ne=Symbol("PopoverGroupContext");function Fe(){return G(Ne,null)}let Oe=Symbol("PopoverPanelContext");function el(){return G(Oe,null)}let Ee=N({name:"Popover",props:{as:{type:[Object,String],default:"div"}},setup(r,{slots:a,attrs:l,expose:e}){var s;let o=`headlessui-popover-button-${ve()}`,n=`headlessui-popover-panel-${ve()}`,t=P(null);e({el:t,$el:t});let i=P(1),f=P(null),b=P(null),y=E(()=>re(t)),d={popoverState:i,buttonId:o,panelId:n,panel:b,button:f,togglePopover(){i.value=ye(i.value,{[0]:1,[1]:0})},closePopover(){i.value!==1&&(i.value=1)},close(w){d.closePopover();let p=(()=>w?w instanceof HTMLElement?w:w.value instanceof HTMLElement?_(w):_(d.button):_(d.button))();p==null||p.focus()}};z(Pe,d),Re(E(()=>ye(i.value,{[0]:te.Open,[1]:te.Closed})));let m={buttonId:o,panelId:n,close(){d.closePopover()}},k=Fe(),F=k==null?void 0:k.registerPopover;function C(){var w,p,g,O;return(O=k==null?void 0:k.isFocusWithinPopoverGroup())!=null?O:((w=y.value)==null?void 0:w.activeElement)&&(((p=_(f))==null?void 0:p.contains(y.value.activeElement))||((g=_(b))==null?void 0:g.contains(y.value.activeElement)))}return fe(()=>F==null?void 0:F(m)),ne((s=y.value)==null?void 0:s.defaultView,"focus",()=>{i.value===0&&(C()||!f||!b||d.closePopover())},!0),qe([f,b],(w,p)=>{var g;i.value===0&&(d.closePopover(),Ge(p,Ke.Loose)||(w.preventDefault(),(g=_(f))==null||g.focus()))}),()=>{let w={open:i.value===0,close:d.close};return Y({props:le(H({},r),{ref:t}),slot:w,slots:a,attrs:l,name:"Popover"})}}}),ll=N({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(r,{attrs:a,slots:l,expose:e}){var s;let o=ie("PopoverButton"),n=E(()=>re(o.button));e({el:o.button,$el:o.button});let t=Fe(),i=t==null?void 0:t.closeOthers,f=el(),b=f===null?!1:f===o.panelId,y=P(null),d=P();ne((s=n.value)==null?void 0:s.defaultView,"focus",()=>{var p;d.value=y.value,y.value=(p=n.value)==null?void 0:p.activeElement},!0);let m=P(null);b||fe(()=>{o.button.value=m.value});let k=ze(E(()=>({as:r.as,type:a.type})),m);function F(p){var g,O,V,L,q,Z,J,K;if(b){if(o.popoverState.value===1)return;switch(p.key){case B.Space:case B.Enter:p.preventDefault(),(O=(g=p.target).click)==null||O.call(g),o.closePopover(),(V=_(o.button))==null||V.focus();break}}else switch(p.key){case B.Space:case B.Enter:p.preventDefault(),p.stopPropagation(),o.popoverState.value===1&&(i==null||i(o.buttonId)),o.togglePopover();break;case B.Escape:if(o.popoverState.value!==0)return i==null?void 0:i(o.buttonId);if(!_(o.button)||((L=n.value)==null?void 0:L.activeElement)&&!((q=_(o.button))!=null&&q.contains(n.value.activeElement)))return;p.preventDefault(),p.stopPropagation(),o.closePopover();break;case B.Tab:if(o.popoverState.value!==0||!o.panel||!o.button)return;if(p.shiftKey){if(!d.value||(Z=_(o.button))!=null&&Z.contains(d.value)||(J=_(o.panel))!=null&&J.contains(d.value))return;let h=pe((K=n.value)==null?void 0:K.body),S=h.indexOf(d.value);if(h.indexOf(_(o.button))>S)return;p.preventDefault(),p.stopPropagation(),R(_(o.panel),A.Last)}else p.preventDefault(),p.stopPropagation(),R(_(o.panel),A.First);break}}function C(p){var g,O,V;if(!b&&(p.key===B.Space&&p.preventDefault(),o.popoverState.value===0&&!!o.panel&&!!o.button))switch(p.key){case B.Tab:if(!d.value||(g=_(o.button))!=null&&g.contains(d.value)||(O=_(o.panel))!=null&&O.contains(d.value))return;let L=pe((V=n.value)==null?void 0:V.body),q=L.indexOf(d.value);if(L.indexOf(_(o.button))>q)return;p.preventDefault(),p.stopPropagation(),R(_(o.panel),A.Last);break}}function w(p){var g,O;r.disabled||(b?(o.closePopover(),(g=_(o.button))==null||g.focus()):(p.preventDefault(),p.stopPropagation(),o.popoverState.value===1&&(i==null||i(o.buttonId)),(O=_(o.button))==null||O.focus(),o.togglePopover()))}return()=>{let p={open:o.popoverState.value===0},g=b?{ref:m,type:k.value,onKeydown:F,onClick:w}:{ref:m,id:o.buttonId,type:k.value,"aria-expanded":r.disabled?void 0:o.popoverState.value===0,"aria-controls":_(o.panel)?o.panelId:void 0,disabled:r.disabled?!0:void 0,onKeydown:F,onKeyup:C,onClick:w};return Y({props:H(H({},r),g),slot:p,attrs:a,slots:l,name:"PopoverButton"})}}});N({name:"PopoverOverlay",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(r,{attrs:a,slots:l}){let e=ie("PopoverOverlay"),s=`headlessui-popover-overlay-${ve()}`,o=Ce(),n=E(()=>o!==null?o.value===te.Open:e.popoverState.value===0);function t(){e.closePopover()}return()=>{let i={open:e.popoverState.value===0};return Y({props:le(H({},r),{id:s,"aria-hidden":!0,onClick:t}),slot:i,attrs:a,slots:l,features:oe.RenderStrategy|oe.Static,visible:n.value,name:"PopoverOverlay"})}}});let tl=N({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1}},setup(r,{attrs:a,slots:l,expose:e}){var s,o;let{focus:n}=r,t=ie("PopoverPanel"),i=E(()=>re(t.panel));e({el:t.panel,$el:t.panel}),z(Oe,t.panelId),Ve(()=>{t.panel.value=null}),fe(()=>{var d,m;if(!n||t.popoverState.value!==0||!t.panel)return;let k=(d=i.value)==null?void 0:d.activeElement;(m=_(t.panel))!=null&&m.contains(k)||R(_(t.panel),A.First)}),ne((s=i.value)==null?void 0:s.defaultView,"keydown",d=>{var m,k,F;if(t.popoverState.value!==0||!_(t.panel)||d.key!==B.Tab||!((m=i.value)!=null&&m.activeElement)||!((k=_(t.panel))!=null&&k.contains(i.value.activeElement)))return;d.preventDefault();let C=R(_(t.panel),d.shiftKey?A.Previous:A.Next);if(C===de.Underflow)return(F=_(t.button))==null?void 0:F.focus();if(C===de.Overflow){if(!_(t.button))return;let w=pe(i.value.body),p=w.indexOf(_(t.button)),g=w.splice(p+1).filter(O=>{var V;return!((V=_(t.panel))!=null&&V.contains(O))});R(g,A.First)===de.Error&&R(i.value.body,A.First)}}),ne((o=i.value)==null?void 0:o.defaultView,"focus",()=>{var d,m;!n||t.popoverState.value===0&&(!_(t.panel)||((d=i.value)==null?void 0:d.activeElement)&&((m=_(t.panel))==null?void 0:m.contains(i.value.activeElement))||t.closePopover())},!0);let f=Ce(),b=E(()=>f!==null?f.value===te.Open:t.popoverState.value===0);function y(d){var m,k;switch(d.key){case B.Escape:if(t.popoverState.value!==0||!_(t.panel)||i.value&&!((m=_(t.panel))!=null&&m.contains(i.value.activeElement)))return;d.preventDefault(),d.stopPropagation(),t.closePopover(),(k=_(t.button))==null||k.focus();break}}return()=>{let d={open:t.popoverState.value===0,close:t.close},m={ref:t.panel,id:t.panelId,onKeydown:y};return Y({props:H(H({},r),m),slot:d,attrs:a,slots:l,features:oe.RenderStrategy|oe.Static,visible:b.value,name:"PopoverPanel"})}}});N({name:"PopoverGroup",props:{as:{type:[Object,String],default:"div"}},setup(r,{attrs:a,slots:l,expose:e}){let s=P(null),o=P([]),n=E(()=>re(s));e({el:s,$el:s});function t(y){let d=o.value.indexOf(y);d!==-1&&o.value.splice(d,1)}function i(y){return o.value.push(y),()=>{t(y)}}function f(){var y;let d=n.value;if(!d)return!1;let m=d.activeElement;return(y=_(s))!=null&&y.contains(m)?!0:o.value.some(k=>{var F,C;return((F=d.getElementById(k.buttonId))==null?void 0:F.contains(m))||((C=d.getElementById(k.panelId))==null?void 0:C.contains(m))})}function b(y){for(let d of o.value)d.buttonId!==y&&d.close()}return z(Ne,{registerPopover:i,unregisterPopover:t,isFocusWithinPopoverGroup:f,closeOthers:b}),()=>Y({props:le(H({},r),{ref:s}),slot:{},attrs:a,slots:l,name:"PopoverGroup"})}});const ol=N({props:{item:null,clickHandler:null},setup(r,{expose:a}){a();const e={props:r};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),nl={class:"flex flex-col w-full pl-3 py-1"};function al(r,a,l,e,s,o){const n=ke("FileLeaf",!0);return c(),v("div",nl,[u("div",{class:"cursor-pointer hover:text-primary",onClick:a[0]||(a[0]=t=>l.clickHandler(l.item))},$(l.item.name),1),(c(!0),v(I,null,D(l.item.children,t=>(c(),T(n,{item:t,"click-handler":l.clickHandler},null,8,["item","click-handler"]))),256))])}var rl=j(ol,[["render",al]]);const il=N({props:{clickHandler:null},async setup(r,{expose:a}){let l,e;const s=r,o=Q(),{refresh:n}=([l,e]=me(async()=>he("root-media-tree",async()=>{await o.fetchTree()})),l=await l,e(),l),{tree:t}=He(o);a({refresh:n});const i={props:s,mediaNodeStore:o,refresh:n,tree:t,FileLeaf:rl};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}}),sl={class:"flex flex-col"},cl=u("h2",{class:"mb-2"},"Arborescence",-1);function dl(r,a,l,e,s,o){return c(),v("div",sl,[cl,(c(!0),v(I,null,D(e.tree,n=>(c(),T(e.FileLeaf,{item:n,"click-handler":l.clickHandler},null,8,["item","click-handler"]))),256))])}var ul=j(il,[["render",dl]]);const vl=N({props:{thumbnails:null,links:null,removeThumbnail:null,removeLink:null},setup(r,{expose:a}){a();const e={props:r,Icon:X};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),pl={class:"flex flex-col"},fl=u("div",{class:"flex-auto"},[u("h3",null,"Fichiers s\xE9lectionn\xE9s")],-1),ml={key:0,class:"flex-auto"},_l=u("p",null," Tu peux t\xE9leverser un fichier ou utiliser le navigateur pour s\xE9lectionner les fichiers \xE0 ins\xE9rer ",-1),hl=[_l],bl={key:1,class:"flex flex-auto"},xl={class:"flex flex-col"},yl={class:"flex flex-auto"},kl=["src"],gl=["onClick"],wl={class:"flex flex-auto"},Cl=["onClick"];function Sl(r,a,l,e,s,o){return c(),v("div",pl,[fl,l.thumbnails.length+l.links.length===0?(c(),v("div",ml,hl)):(c(),v("div",bl,[u("div",xl,[u("div",yl,[(c(!0),v(I,null,D(l.thumbnails,(n,t)=>(c(),v("div",{class:"self-center flex-auto",key:t},[u("div",null,[u("img",{src:n.src,class:"max-h-52"},null,8,kl),u("div",null,[u("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:i=>l.removeThumbnail(t)},[x(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,gl)])])]))),128))]),u("div",wl,[(c(!0),v(I,null,D(l.links,(n,t)=>(c(),v("div",{class:"flex-auto",key:t},[u("span",null,[W($(n.name)+" ",1),u("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:i=>l.removeLink(t)},[x(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,Cl)])]))),128))])])]))])}var Pl=j(vl,[["render",Sl]]);const Nl=N({props:{handleUpload:null},setup(r,{expose:a}){a();const l=r,e=P(null),n={props:l,fileSelection:e,openFileSelection:()=>{var t;(t=e.value)==null||t.click()},onFileChange:()=>{var i;const t=(i=e.value)==null?void 0:i.files;t&&l.handleUpload(t)}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),Fl={class:"flex flex-col mt-6"};function Ol(r,a,l,e,s,o){return c(),v("div",Fl,[u("input",{id:"fileElem",ref:"fileSelection",type:"file",multiple:"",accept:"image/*",style:{display:"none"},onChange:e.onFileChange},null,544),u("button",{onClick:e.openFileSelection,class:"bg-primary text-white py-3 px-6 rounded-md w-fit"}," T\xE9l\xE9verser des fichiers ")])}var El=j(Nl,[["render",Ol]]);const jl=N({props:{mediaNode:{default:null},mediaNodeClickHandler:null,handleRootClick:null},setup(r,{expose:a}){a();const l=r,s={props:l,handleCrumbClick:o=>{l.mediaNodeClickHandler(o.id)},Icon:X};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),Il={key:0,class:"flex flex-row w-full"},Dl=["onClick"],Ml=W("\xA0"),Tl={class:"cursor-pointer text-primary"};function Vl(r,a,l,e,s,o){return l.mediaNode?(c(),v("div",Il,[x(e.Icon,{icon:"ri-home-fill",class:"h-6 w-6 cursor-pointer fill-primary",onClick:l.handleRootClick},null,8,["onClick"]),(c(!0),v(I,null,D(l.mediaNode.breadcrumb,n=>(c(),v("div",{key:n["@id"],onClick:t=>e.handleCrumbClick(n),class:"inline-flex items-center cursor-pointer"},[Ml,x(e.Icon,{icon:"ri-arrow-right-s-line",class:"h-6 w-6"}),u("div",Tl,$(n.name),1)],8,Dl))),128))])):U("",!0)}var Hl=j(jl,[["render",Vl]]);const Bl=N({props:{mediaNode:{default:null},handleClick:null},setup(r,{expose:a}){a();const e={props:r};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),$l={class:"flex flex-row py-3"},Ul=["onClick"];function Al(r,a,l,e,s,o){return c(),v("div",$l,[(c(!0),v(I,null,D(l.mediaNode.children,n=>(c(),v("div",{key:n["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary"},[u("button",{onClick:t=>e.props.handleClick(n.id)},$(n.name),9,Ul)]))),128))])}var Ll=j(Bl,[["render",Al]]);const Rl=N({props:{mediaNode:{default:null},selectClickHandler:null,editClickHandler:null,removeClickHandler:null},setup(r,{expose:a}){a();const l=r,e=G("selectionEnabled"),s=ae(),o=()=>{l.mediaNode&&s.fetchAll({mediaNodes:l.mediaNode.id,"exists[original]":!1})};Be(()=>{o()}),_e(()=>l.mediaNode,t=>{o()});const n={props:l,selectionEnabled:e,mediaObjectStore:s,loadObjects:o,Icon:X,Popover:Ee,PopoverButton:ll,PopoverPanel:tl};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),ql={class:"flex flex-row flex-wrap gap-1"},Gl=["src"],Kl={key:1,class:"px-3 py-3 border border-primary"},zl={class:"bg-gray-100 p-1"},Ql={key:0},Wl={key:1},Xl={class:"flex flex-row bg-gray-100 pb-1"},Yl=W(" Ajouter... "),Zl=["onClick"],Jl=["onClick"];function et(r,a,l,e,s,o){return c(),v("div",ql,[(c(!0),v(I,null,D(e.mediaObjectStore.list,n=>(c(),v("div",{key:n["@id"],class:"flex flex-col"},[u("div",null,[n.isImage?(c(),v("img",{key:0,src:n.contentUrl,class:"file-navigator-object max-h-80"},null,8,Gl)):(c(),v("div",Kl,$(n.filePath),1))]),u("div",zl,[n.customName?(c(),v("small",Ql,$(n.customName),1)):(c(),v("small",Wl,"Titre non d\xE9fini"))]),u("div",Xl,[e.selectionEnabled?(c(),T(e.Popover,{key:0,class:"relative"},{default:M(()=>[x(e.PopoverButton,{class:"rounded-lg text-sm text-white bg-primary hover:bg-primary-dark h-fit w-fit cursor-pointer py-2 px-3 uppercase"},{default:M(()=>[Yl]),_:1}),x(e.PopoverPanel,{class:"absolute z-10 bg-primary bottom-10 left-2 text-white rounded-lg"},{default:M(()=>[u("div",{class:"w-full cursor-pointer hover:bg-primary-dark px-3 py-2",onClick:t=>l.selectClickHandler(n)},"Original",8,Zl),(c(!0),v(I,null,D(n.thumbnails,t=>(c(),v("div",{class:"w-full cursor-pointer hover:bg-primary-dark px-3 py-2",onClick:i=>l.selectClickHandler(t)},$(t.size),9,Jl))),256))]),_:2},1024)]),_:2},1024)):U("",!0),x(e.Icon,{icon:"ri-pencil-line",onClick:t=>l.editClickHandler(n),class:"fill-primary hover:fill-primary-dark h-8 w-8 cursor-pointer"},null,8,["onClick"]),x(e.Icon,{icon:"ri-delete-bin-line",onClick:t=>l.removeClickHandler(n),class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer"},null,8,["onClick"])])]))),128))])}var lt=j(Rl,[["render",et]]);const tt=N({props:{mediaNode:{default:null},dialog:{type:Boolean},refresh:null},emits:["update:dialog"],setup(r,{expose:a,emit:l}){a();const e=r,s=E({get(){return e.dialog},set(i){l("update:dialog",i)}}),o=Q(),t={props:e,emit:l,show:s,mediaNodeStore:o,onFolderCreate:async i=>{var f;s.value=!1,i.name&&(await o.create({name:i.name,parent:(f=e.mediaNode)==null?void 0:f["@id"]}),await e.refresh())},TransitionRoot:Qe,TransitionChild:We,Dialog:Xe,DialogPanel:Ye,DialogTitle:Ze,Form:ge,TextField:Se};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),ot=u("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),nt={class:"fixed inset-0 overflow-y-auto"},at={class:"flex min-h-full items-center justify-center p-4 text-center"},rt=W("Ajouter un dossier"),it=u("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Cr\xE9er le dossier",-1);function st(r,a,l,e,s,o){return c(),T(e.TransitionRoot,{appear:"",show:e.show,as:"template"},{default:M(()=>[x(e.Dialog,{as:"div",open:e.show,onClose:a[0]||(a[0]=n=>e.show=!1),class:"relative z-10"},{default:M(()=>[x(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:M(()=>[ot]),_:1}),u("div",nt,[u("div",at,[x(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:M(()=>[x(e.DialogPanel,{class:"w-full max-w-md transform overflow-hidden rounded-2xl p-6 text-left align-middle shadow-xl transition-all bg-sky-100"},{default:M(()=>[x(e.DialogTitle,{as:"h3"},{default:M(()=>[rt]),_:1}),x(e.Form,{onSubmit:e.onFolderCreate,class:"flex flex-row flex-wrap","validation-schema":{name:"min:3"}},{default:M(({values:n,errors:t})=>[x(e.TextField,{name:"name",error:t.name,value:n.name,label:"Nom du dossier",class:"w-full"},null,8,["error","value"]),it]),_:1})]),_:1})]),_:1})])])]),_:1},8,["open"])]),_:1},8,["show"])}var ct=j(tt,[["render",st]]);const dt=N({props:{editClickHandler:null,selectClickHandler:null,removeClickHandler:null,removeFolderClickHandler:null,refreshHandler:null,modelValue:null,rootName:{default:null}},emits:["update:modelValue"],async setup(r,{expose:a,emit:l}){let e,s;const o=r,n=P(!1),t=E({get(){return o.modelValue},set(C){l("update:modelValue",C)}}),i=Q(),f=ae(),b=G("closeDetailPanel"),{refresh:y}=([e,s]=me(async()=>he("root-media-nodes",async()=>{await i.fetchAll({"exists[parent]":"false"})})),e=await e,s(),e),d=async C=>{f.resetList(),await i.load(C),t.value=i[ue.EDITION].retrieved},m=()=>{t.value=null,b&&b()},k=async C=>{!t.value&&C===null?y():(C?await i.load(C.id):await i.load(t.value.id),t.value=i[ue.EDITION].retrieved)};a({refresh:k});const F={props:o,emit:l,folderDialog:n,currentMediaNode:t,mediaNodeStore:i,mediaObjectStore:f,closeDetailPanel:b,getRoots:y,handleMediaNodeClick:d,handleRootClick:m,refresh:k,FileNavigatorBreadCrumb:Hl,FileNavigatorFolders:Ll,FileNavigatorFiles:lt,FileNavigatorContextMenu:ct,Icon:X};return Object.defineProperty(F,"__isScriptSetup",{enumerable:!1,value:!0}),F}}),ut={class:"flex flex-col"},vt=u("div",null,[u("h1",{class:"navigator-title"},"Navigateur de fichier")],-1),pt={class:"flex-auto py-2"},ft={key:0,class:"flex-auto flex flex-col"},mt={class:"flex flex-row h-16 items-center gap-x-2"},_t=u("h2",null,"Dossiers",-1),ht={key:1},bt={key:1,class:"flex-auto"},xt=u("div",{class:"py-2"},[u("h2",null,"Fichiers")],-1),yt={key:2,class:"flex-auto flex flex-col"},kt={class:"flex flex-row h-16 items-center gap-x-2"},gt=u("h2",null,"S\xE9lectionner un dossier",-1),wt={class:"flex flex-row"},Ct=["onClick"];function St(r,a,l,e,s,o){return c(),v("div",ut,[vt,u("div",pt,[x(e.FileNavigatorBreadCrumb,{"media-node":e.props.modelValue,"media-node-click-handler":e.handleMediaNodeClick,"handle-root-click":e.handleRootClick},null,8,["media-node"])]),e.currentMediaNode?(c(),v("div",ft,[u("div",mt,[_t,x(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:a[0]||(a[0]=n=>e.folderDialog=!0)}),x(e.Icon,{icon:"ri-delete-bin-line",class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer",onClick:a[1]||(a[1]=n=>l.removeFolderClickHandler(e.currentMediaNode))})]),e.currentMediaNode.children.length>0?(c(),T(e.FileNavigatorFolders,{key:0,"media-node":e.currentMediaNode,"handle-click":e.handleMediaNodeClick},null,8,["media-node"])):(c(),v("p",ht," Aucun dossier "))])):U("",!0),e.currentMediaNode&&e.currentMediaNode.mediaObjects.length>0?(c(),v("div",bt,[xt,u("div",null,[x(e.FileNavigatorFiles,{"select-click-handler":e.props.selectClickHandler,"edit-click-handler":e.props.editClickHandler,"remove-click-handler":e.props.removeClickHandler,"media-node":e.currentMediaNode},null,8,["select-click-handler","edit-click-handler","remove-click-handler","media-node"])])])):U("",!0),e.currentMediaNode?U("",!0):(c(),v("div",yt,[u("div",kt,[gt,x(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:a[2]||(a[2]=n=>e.folderDialog=!0)})]),u("div",wt,[(c(!0),v(I,null,D(e.mediaNodeStore.list,n=>(c(),v("div",{key:n["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary cursor-pointer",onClick:t=>e.handleMediaNodeClick(n.id)},$(n.name),9,Ct))),128))])])),x(e.FileNavigatorContextMenu,{"media-node":e.props.modelValue,refresh:l.refreshHandler,dialog:e.folderDialog,"onUpdate:dialog":a[3]||(a[3]=n=>e.folderDialog=n)},null,8,["media-node","refresh","dialog"])])}var Pt=j(dt,[["render",St]]);const Nt=N({props:{item:null,level:null,modelValue:null},emits:["update:modelValue"],setup(r,{expose:a,emit:l}){a();const e=r,s=E(()=>e.context.tree),o=E({get(){return e.modelValue},set(f){l("update:modelValue",f)}}),n=E(()=>o.value.indexOf(e.item["@id"])!==-1);function t(f){f.target.checked?o.value=[...o.value,f.target.value]:o.value=o.value.filter(b=>b!==f.target.value)}const i={props:e,items:s,emit:l,ids:o,isChecked:n,onChange:t};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}}),Ft=["value"];function Ot(r,a,l,e,s,o){const n=ke("FileTreeViewItem",!0);return c(),v("div",{class:Ae(`pl-${l.level*2}`)},[$e(u("input",{type:"checkbox",value:l.item["@id"],onChange:e.onChange,"onUpdate:modelValue":a[0]||(a[0]=t=>e.isChecked=t),class:"ring-primary text-primary border-0 rounded-md focus:ring-0"},null,40,Ft),[[Ue,e.isChecked]]),W(" "+$(l.item.name)+" ",1),l.item.children.length>0?(c(!0),v(I,{key:0},D(l.item.children,t=>(c(),T(n,{item:t,level:l.level+1,modelValue:e.ids,"onUpdate:modelValue":a[1]||(a[1]=i=>e.ids=i)},null,8,["item","level","modelValue"]))),256)):U("",!0)],2)}var Et=j(Nt,[["render",Ot]]);const jt=N({props:{name:null,tree:null,value:null},setup(r,{expose:a}){a();const l=r,{value:e,errorMessage:s,handleBlur:o,handleChange:n,meta:t}=Le(l.name,void 0,{initialValue:l.value}),i=P(l.value?[...l.value]:[]);_e(i,b=>{e.value=b});const f={props:l,inputValue:e,errorMessage:s,handleBlur:o,handleChange:n,meta:t,choices:i,FileTreeViewItem:Et};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),It={class:"flex flex-col w-full"};function Dt(r,a,l,e,s,o){return c(),v("div",It,[(c(!0),v(I,null,D(l.tree,n=>(c(),T(e.FileTreeViewItem,{item:n,level:1,modelValue:e.choices,"onUpdate:modelValue":a[0]||(a[0]=t=>e.choices=t)},null,8,["item","modelValue"]))),256))])}var Mt=j(jt,[["render",Dt]]);const Tt=N({props:{mediaObject:null,tree:null,handleSubmit:null,errors:null},emits:["update:mediaObject"],setup(r,{expose:a,emit:l}){a();const e=r,s=E({get(){return e.mediaObject},set(n){l("update:mediaObject",n)}}),o={props:e,emit:l,item:s,FileTreeView:Mt,Form:ge,TextField:Se};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),Vt=u("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Mettre \xE0 jour",-1);function Ht(r,a,l,e,s,o){return c(),T(e.Form,{onSubmit:l.handleSubmit,class:"flex flex-row flex-wrap","initial-values":e.item},{default:M(({values:n,errors:t})=>[x(e.TextField,{name:"uniqueId",error:t.uniqueId,value:n.uniqueId,label:"Identifiant unique",class:"w-full","field-attrs":{disabled:"disabled"}},null,8,["error","value"]),x(e.TextField,{name:"customName",error:t.customName,value:n.customName,label:"Nom personnalis\xE9",class:"w-full"},null,8,["error","value"]),x(e.FileTreeView,{tree:l.tree,name:"mediaNodes",value:n.mediaNodes},null,8,["tree","value"]),Vt]),_:1},8,["onSubmit","initial-values"])}var Bt=j(Tt,[["render",Ht]]);const $t=N({props:{mediaObject:null,removeClickHandler:null},async setup(r,{expose:a}){a();let l,e;const s=r,o=G("closeDetailPanel"),n=P(H({},s.mediaObject)),t=Q(),i=ae(),f=we();[l,e]=me(async()=>he("media-node-tree",async()=>{await t.fetchTree()})),await l,e();const b=async m=>{try{await i.update(m.uniqueId,m),f.showMessage("Fichier mis \xE0 jour")}catch{f.showError("Probl\xE8me lors de la mise \xE0 jour du fichier")}},y=async m=>{const k=await i.generateThumbnails(m);n.value=k};_e(()=>s.mediaObject,m=>{m&&(n.value=H({},m))});const d={props:s,closeDetailPanel:o,item:n,mediaNodeStore:t,mediaObjectStore:i,notificationStore:f,onSendForm:b,generateThumbnails:y,FileDetailsForm:Bt,Icon:X,CRUD_MODE:ue};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),Ut={class:"flex flex-col"},At={class:"flex flex-row"},Lt=u("h2",{class:"mb-3"},"D\xE9tail du fichier",-1),Rt={class:"flex flex-col px-2"},qt=u("h2",{class:"py-2"},"Miniatures",-1),Gt={class:"flex flex-col"},Kt=["src","alt"],zt={key:1},Qt=u("p",null,"Aucune miniature",-1),Wt=[Qt];function Xt(r,a,l,e,s,o){return c(),v("div",Ut,[u("div",At,[Lt,x(e.Icon,{icon:"ri-close-line",class:"h-6 w-6 rounded-md fill-primary justify-self-end",onClick:e.closeDetailPanel},null,8,["onClick"])]),u("div",null,[x(e.FileDetailsForm,{tree:e.mediaNodeStore.tree,mediaObject:e.item,"onUpdate:mediaObject":a[0]||(a[0]=n=>e.item=n),"handle-submit":e.onSendForm,errors:e.mediaObjectStore[e.CRUD_MODE.EDITION].violations},null,8,["tree","mediaObject","errors"])]),u("div",Rt,[qt,e.item.thumbnails.length>0?(c(!0),v(I,{key:0},D(e.item.thumbnails,n=>(c(),v("div",Gt,[u("img",{src:n.contentUrl,alt:n.customName||n.uniqueId,class:"w-fit h-auto object-scale-down"},null,8,Kt),x(e.Icon,{icon:"ri-delete-bin-line",onClick:t=>l.removeClickHandler(n,!0),class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer"},null,8,["onClick"])]))),256)):(c(),v("div",zt,Wt)),u("div",{class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark cursor-pointer text-center",onClick:a[1]||(a[1]=n=>e.generateThumbnails(e.item))},"G\xE9n\xE9rer les miniatures")])])}var Yt=j($t,[["render",Xt]]);const Zt=N({props:{showSelection:{type:Boolean,default:!0}},setup(r,{expose:a}){const l=r,e=we(),s=ae(),o=Q(),n=P(null),t=P([]),i=P([]),f=P(null),b=P(null),y=P(null);z("closeDetailPanel",()=>{n.value=null}),z("selectionEnabled",l.showSelection);const d=()=>{i.value=[],t.value=[]},m=h=>{h.isImage?k(h):F(h)},k=h=>{var S;i.value.push({src:h.contentUrl,alt:(S=h.customName)!=null?S:h.uniqueId})},F=h=>{t.value.push({src:h.contentUrl,name:h.filePath})},C=h=>{i.value.splice(h,1)},w=h=>{t.value.splice(h,1)},p=(h=null)=>{var S,ee;(S=b.value)==null||S.refresh(h),(ee=y.value)==null||ee.refresh()},g=(h=null)=>{var S;(S=b.value)==null||S.refresh(h)},O=()=>{var h;(h=y.value)==null||h.refresh()},V=h=>{if(!!f.value)for(let S=0;S<h.length;S++){const ee=h[S],se=new FormData;se.append("file",ee),se.append("mediaNodeId",f.value.id.toString()),s.create(se).then(ce=>{ce.isImage?k(ce):F(ce),g()})}},L=h=>{n.value=h},q=async h=>{try{await s.remove(h.uniqueId),g(),n.value=null,e.showMessage("Media correctement supprim\xE9")}catch{e.showError("Erreur dans la suppression du m\xE9dia")}},Z=async h=>{try{await o.remove(h.id),f.value=null,p(),e.showMessage("Dossier correctement supprim\xE9")}catch{e.showError("Erreur dans la suppression du dossier")}},J=async h=>{var S;await((S=b.value)==null?void 0:S.refresh(h))};a({links:t,thumbnails:i,reset:d});const K={props:l,notificationStore:e,mediaObjectStore:s,mediaNodeStore:o,selectedMediaObject:n,links:t,thumbnails:i,currentMediaNode:f,fileNavigator:b,fileArbo:y,reset:d,selectMediaObject:m,selectImage:k,selectLink:F,removeThumbnail:C,removeLink:w,refreshAll:p,refreshNavigator:g,refreshArbo:O,handleUpload:V,editMediaObject:L,removeMediaObject:q,removeFolderClickHandler:Z,onTreeItemClick:J,FileArbo:ul,FileSelection:Pl,FileUploader:El,FileNavigator:Pt,FileDetails:Yt};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Jt={class:"flex flex-row"},eo={class:"flex flex-col flex-auto w-1/2"};function lo(r,a,l,e,s,o){return c(),v("div",Jt,[x(e.FileArbo,{ref:"fileArbo",class:"flex w-1/6","click-handler":e.onTreeItemClick},null,512),u("div",eo,[x(e.FileNavigator,{ref:"fileNavigator","select-click-handler":e.selectMediaObject,"edit-click-handler":e.editMediaObject,"remove-click-handler":e.removeMediaObject,"remove-folder-click-handler":e.removeFolderClickHandler,"refresh-handler":e.refreshAll,"show-selection":l.showSelection,modelValue:e.currentMediaNode,"onUpdate:modelValue":a[0]||(a[0]=n=>e.currentMediaNode=n)},null,8,["show-selection","modelValue"]),e.currentMediaNode?(c(),T(e.FileUploader,{key:0,"handle-upload":e.handleUpload})):U("",!0),l.showSelection?(c(),T(e.FileSelection,{key:1,thumbnails:e.thumbnails,links:e.links,"remove-link":e.removeLink,"remove-thumbnail":e.removeThumbnail},null,8,["thumbnails","links"])):U("",!0)]),e.selectedMediaObject?(c(),T(e.FileDetails,{key:0,class:"flex w-1/3","media-object":e.selectedMediaObject,"remove-click-handler":e.removeMediaObject},null,8,["media-object"])):U("",!0)])}var uo=j(Zt,[["render",lo]]);export{uo as F,Ee as p,tl as w,ll as x};
