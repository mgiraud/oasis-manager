var ie=Object.defineProperty;var $=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var G=(i,n,l)=>n in i?ie(i,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[n]=l,J=(i,n)=>{for(var l in n||(n={}))re.call(n,l)&&G(i,l,n[l]);if($)for(var l of $(n))ae.call(n,l)&&G(i,l,n[l]);return i};import{_ as v,d as p,o as r,c as u,k as s,F as N,l as S,b as m,g as V,t as j,h as g,f as C,T as R,i as T,Q as se,A as q,e as F,j as D,I as P,w,J as K,q as W,C as E,r as ce,V as de,ag as ue,n as me,G as fe,s as X,O as Q}from"./entry-a96e082f.mjs";import{I}from"./Icon-8316deac.mjs";import{u as Y}from"./asyncData-d8550ba9.mjs";import{T as Z}from"./TextField-8fccfdb3.mjs";import{f as _e,o as he}from"./transition-301b7402.mjs";import{M as ve,j as pe,A as xe}from"./dialog-d2f33145.mjs";const ke=p({props:{thumbnails:null,links:null,removeThumbnail:null,removeLink:null},setup(i,{expose:n}){n();const e={props:i,Icon:I};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),be={class:"flex flex-col"},ye=s("div",{class:"flex-auto"},[s("h3",null,"Fichiers s\xE9lectionn\xE9s")],-1),ge={key:0,class:"flex-auto"},Ce=s("p",null," Tu peux t\xE9leverser un fichier ou utiliser le navigateur pour s\xE9lectionner les fichiers \xE0 ins\xE9rer ",-1),we=[Ce],Ne={key:1,class:"flex flex-auto"},Se={class:"flex flex-col"},Fe={class:"flex flex-auto"},je=["src"],Oe=["onClick"],Me={class:"flex flex-auto"},De=["onClick"];function Ie(i,n,l,e,c,a){return r(),u("div",be,[ye,l.thumbnails.length+l.links.length===0?(r(),u("div",ge,we)):(r(),u("div",Ne,[s("div",Se,[s("div",Fe,[(r(!0),u(N,null,S(l.thumbnails,(o,t)=>(r(),u("div",{class:"self-center flex-auto",key:t},[s("div",null,[s("img",{src:o.src,class:"max-h-52"},null,8,je),s("div",null,[s("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:d=>l.removeThumbnail(t)},[m(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,Oe)])])]))),128))]),s("div",Me,[(r(!0),u(N,null,S(l.links,(o,t)=>(r(),u("div",{class:"flex-auto",key:t},[s("span",null,[V(j(o.name)+" ",1),s("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:d=>l.removeLink(t)},[m(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,De)])]))),128))])])]))])}var Ee=v(ke,[["render",Ie]]);const Ve=p({props:{handleUpload:null},setup(i,{expose:n}){n();const l=i,e=g(null),o={props:l,fileSelection:e,openFileSelection:()=>{var t;(t=e.value)==null||t.click()},onFileChange:()=>{var d;const t=(d=e.value)==null?void 0:d.files;t&&l.handleUpload(t)}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),Te={class:"flex flex-col mt-6"};function Pe(i,n,l,e,c,a){return r(),u("div",Te,[s("input",{id:"fileElem",ref:"fileSelection",type:"file",multiple:"",accept:"image/*",style:{display:"none"},onChange:e.onFileChange},null,544),s("button",{onClick:e.openFileSelection,class:"bg-primary text-white py-3 px-6 rounded-md w-fit"}," T\xE9l\xE9verser des fichiers ")])}var He=v(Ve,[["render",Pe]]);const Ue=p({props:{mediaNode:{default:null},mediaNodeClickHandler:null,handleRootClick:null},setup(i,{expose:n}){n();const l=i,c={props:l,handleCrumbClick:a=>{l.mediaNodeClickHandler(a.id)},Icon:I};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),Ae={key:0,class:"flex flex-row w-full"},Be=["onClick"],Re=V("\xA0"),qe={class:"cursor-pointer text-primary"};function Le(i,n,l,e,c,a){return l.mediaNode?(r(),u("div",Ae,[m(e.Icon,{icon:"ri-home-fill",class:"h-6 w-6 cursor-pointer fill-primary",onClick:l.handleRootClick},null,8,["onClick"]),(r(!0),u(N,null,S(l.mediaNode.breadcrumb,o=>(r(),u("div",{key:o["@id"],onClick:t=>e.handleCrumbClick(o),class:"inline-flex items-center cursor-pointer"},[Re,m(e.Icon,{icon:"ri-arrow-right-s-line",class:"h-6 w-6"}),s("div",qe,j(o.name),1)],8,Be))),128))])):C("",!0)}var ze=v(Ue,[["render",Le]]);const $e=p({props:{mediaNode:{default:null},handleClick:null},setup(i,{expose:n}){n();const e={props:i};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),Ge={class:"flex flex-row py-3"},Je=["onClick"];function Qe(i,n,l,e,c,a){return r(),u("div",Ge,[(r(!0),u(N,null,S(l.mediaNode.children,o=>(r(),u("div",{key:o["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary"},[s("button",{onClick:t=>e.props.handleClick(o.id)},j(o.name),9,Je)]))),128))])}var Ke=v($e,[["render",Qe]]);const We=p({props:{mediaNode:{default:null},selectClickHandler:null,editClickHandler:null,removeClickHandler:null},setup(i,{expose:n}){n();const l=i,e=R("selectionEnabled"),c=T(),a=()=>{l.mediaNode&&c.fetchAll({mediaNodes:l.mediaNode.id})};se(()=>{a()}),q(()=>l.mediaNode,t=>{a()});const o={props:l,selectionEnabled:e,mediaObjectStore:c,loadObjects:a,Icon:I};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),Xe={class:"flex flex-row"},Ye=["src"],Ze={key:1,class:"px-3 py-3 border border-primary"},el={key:0},ll={key:1},nl={class:"flex flex-row"};function ol(i,n,l,e,c,a){return r(),u("div",Xe,[(r(!0),u(N,null,S(e.mediaObjectStore.list,o=>(r(),u("div",{key:o["@id"],class:"flex flex-col"},[s("div",null,[o.isImage?(r(),u("img",{key:0,src:o.contentUrl,class:"file-navigator-object max-h-80"},null,8,Ye)):(r(),u("div",Ze,j(o.filePath),1))]),s("div",null,[o.customName?(r(),u("span",el,j(o.customName),1)):(r(),u("small",ll,"Titre non d\xE9fini"))]),s("div",nl,[e.selectionEnabled?(r(),F(e.Icon,{key:0,icon:"ri-arrow-left-up-line",onClick:t=>l.selectClickHandler(o),class:"fill-primary h-8 w-8 cursor-pointer"},null,8,["onClick"])):C("",!0),m(e.Icon,{icon:"ri-pencil-line",onClick:t=>l.editClickHandler(o),class:"fill-primary hover:fill-primary-dark h-8 w-8 cursor-pointer"},null,8,["onClick"]),m(e.Icon,{icon:"ri-delete-bin-line",onClick:t=>l.removeClickHandler(o),class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer"},null,8,["onClick"])])]))),128))])}var tl=v(We,[["render",ol]]);const il=p({props:{mediaNode:{default:null},dialog:{type:Boolean},refresh:null},emits:["update:dialog"],setup(i,{expose:n,emit:l}){n();const e=i,c=D({get(){return e.dialog},set(d){l("update:dialog",d)}}),a=P(),t={props:e,emit:l,show:c,mediaNodeStore:a,onFolderCreate:async d=>{var f;c.value=!1,d.name&&(await a.create({name:d.name,parent:(f=e.mediaNode)==null?void 0:f["@id"]}),await e.refresh())},TransitionRoot:_e,TransitionChild:he,Dialog:ve,DialogPanel:pe,DialogTitle:xe,Form:K,TextField:Z};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),rl=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),al={class:"fixed inset-0 overflow-y-auto"},sl={class:"flex min-h-full items-center justify-center p-4 text-center"},cl=V("Ajouter un dossier"),dl=s("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Cr\xE9er le dossier",-1);function ul(i,n,l,e,c,a){return r(),F(e.TransitionRoot,{appear:"",show:e.show,as:"template"},{default:w(()=>[m(e.Dialog,{as:"div",open:e.show,onClose:n[0]||(n[0]=o=>e.show=!1),class:"relative z-10"},{default:w(()=>[m(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:w(()=>[rl]),_:1}),s("div",al,[s("div",sl,[m(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:w(()=>[m(e.DialogPanel,{class:"w-full max-w-md transform overflow-hidden rounded-2xl p-6 text-left align-middle shadow-xl transition-all bg-sky-100"},{default:w(()=>[m(e.DialogTitle,{as:"h3"},{default:w(()=>[cl]),_:1}),m(e.Form,{onSubmit:e.onFolderCreate,class:"flex flex-row flex-wrap","validation-schema":{name:"min:3"}},{default:w(({values:o,errors:t})=>[m(e.TextField,{name:"name",error:t.name,value:o.name,label:"Nom du dossier",class:"w-full"},null,8,["error","value"]),dl]),_:1})]),_:1})]),_:1})])])]),_:1},8,["open"])]),_:1},8,["show"])}var ml=v(il,[["render",ul]]);const fl=p({props:{editClickHandler:null,selectClickHandler:null,removeClickHandler:null,removeFolderClickHandler:null,modelValue:null,rootName:{default:null}},emits:["update:modelValue"],async setup(i,{expose:n,emit:l}){let e,c;const a=i,o=g(!1),t=D({get(){return a.modelValue},set(b){l("update:modelValue",b)}}),d=P(),f=T(),h=R("closeDetailPanel"),{refresh:x}=([e,c]=W(async()=>Y("root-media-nodes",async()=>{await d.fetchAll({"exists[parent]":"false"})})),e=await e,c(),e),k=async b=>{f.resetList(),await d.load(b),t.value=d[E.EDITION].retrieved},H=()=>{t.value=null,h&&h()},O=async b=>{!t.value||b===null?x():(b?await d.load(b.id):await d.load(t.value.id),t.value=d[E.EDITION].retrieved)};n({refresh:O});const M={props:a,emit:l,folderDialog:o,currentMediaNode:t,mediaNodeStore:d,mediaObjectStore:f,closeDetailPanel:h,getRoots:x,handleMediaNodeClick:k,handleRootClick:H,refresh:O,FileNavigatorBreadCrumb:ze,FileNavigatorFolders:Ke,FileNavigatorFiles:tl,FileNavigatorContextMenu:ml,Icon:I};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}}),_l={class:"flex flex-col"},hl=s("div",null,[s("h1",{class:"navigator-title"},"Navigateur de fichier")],-1),vl={class:"flex-auto py-2"},pl={key:0,class:"flex-auto flex flex-col"},xl={class:"flex flex-row h-16 items-center gap-x-2"},kl=s("h2",null,"Dossiers",-1),bl={key:1},yl={key:1,class:"flex-auto"},gl=s("div",null,[s("h2",null,"Fichiers")],-1),Cl={key:2,class:"flex-auto flex flex-col"},wl={class:"flex flex-row h-16 items-center gap-x-2"},Nl=s("h2",null,"S\xE9lectionner un dossier",-1),Sl={class:"flex flex-row"},Fl=["onClick"];function jl(i,n,l,e,c,a){return r(),u("div",_l,[hl,s("div",vl,[m(e.FileNavigatorBreadCrumb,{"media-node":e.props.modelValue,"media-node-click-handler":e.handleMediaNodeClick,"handle-root-click":e.handleRootClick},null,8,["media-node"])]),e.currentMediaNode?(r(),u("div",pl,[s("div",xl,[kl,m(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:n[0]||(n[0]=o=>e.folderDialog=!0)}),m(e.Icon,{icon:"ri-delete-bin-line",class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer",onClick:n[1]||(n[1]=o=>l.removeFolderClickHandler(e.currentMediaNode))})]),e.currentMediaNode.children.length>0?(r(),F(e.FileNavigatorFolders,{key:0,"media-node":e.currentMediaNode,"handle-click":e.handleMediaNodeClick},null,8,["media-node"])):(r(),u("p",bl," Aucun dossier "))])):C("",!0),e.currentMediaNode&&e.currentMediaNode.mediaObjects.length>0?(r(),u("div",yl,[gl,s("div",null,[m(e.FileNavigatorFiles,{"select-click-handler":e.props.selectClickHandler,"edit-click-handler":e.props.editClickHandler,"remove-click-handler":e.props.removeClickHandler,"media-node":e.currentMediaNode},null,8,["select-click-handler","edit-click-handler","remove-click-handler","media-node"])])])):C("",!0),e.currentMediaNode?C("",!0):(r(),u("div",Cl,[s("div",wl,[Nl,m(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:n[2]||(n[2]=o=>e.folderDialog=!0)})]),s("div",Sl,[(r(!0),u(N,null,S(e.mediaNodeStore.list,o=>(r(),u("div",{key:o["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary cursor-pointer",onClick:t=>e.handleMediaNodeClick(o.id)},j(o.name),9,Fl))),128))])])),m(e.FileNavigatorContextMenu,{"media-node":e.props.modelValue,refresh:e.refresh,dialog:e.folderDialog,"onUpdate:dialog":n[3]||(n[3]=o=>e.folderDialog=o)},null,8,["media-node","dialog"])])}var Ol=v(fl,[["render",jl]]);const Ml=p({props:{item:null,level:null,modelValue:null},emits:["update:modelValue"],setup(i,{expose:n,emit:l}){n();const e=i,c=D(()=>e.context.tree),a=D({get(){return e.modelValue},set(f){l("update:modelValue",f)}}),o=D(()=>a.value.indexOf(e.item["@id"])!==-1);function t(f){f.target.checked?a.value=[...a.value,f.target.value]:a.value=a.value.filter(h=>h!==f.target.value)}const d={props:e,items:c,emit:l,ids:a,isChecked:o,onChange:t};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),Dl=["value"];function Il(i,n,l,e,c,a){const o=ce("FileTreeViewItem",!0);return r(),u("div",{class:me(`pl-${l.level*2}`)},[de(s("input",{type:"checkbox",value:l.item["@id"],onChange:e.onChange,"onUpdate:modelValue":n[0]||(n[0]=t=>e.isChecked=t),class:"ring-primary text-primary border-0 rounded-md focus:ring-0"},null,40,Dl),[[ue,e.isChecked]]),V(" "+j(l.item.name)+" ",1),l.item.children.length>0?(r(!0),u(N,{key:0},S(l.item.children,t=>(r(),F(o,{item:t,level:l.level+1,modelValue:e.ids,"onUpdate:modelValue":n[1]||(n[1]=d=>e.ids=d)},null,8,["item","level","modelValue"]))),256)):C("",!0)],2)}var El=v(Ml,[["render",Il]]);const Vl=p({props:{name:null,tree:null,value:null},setup(i,{expose:n}){n();const l=i,{value:e,errorMessage:c,handleBlur:a,handleChange:o,meta:t}=fe(l.name,void 0,{initialValue:l.value}),d=g(l.value?[...l.value]:[]);q(d,h=>{e.value=h});const f={props:l,inputValue:e,errorMessage:c,handleBlur:a,handleChange:o,meta:t,choices:d,FileTreeViewItem:El};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),Tl={class:"flex flex-col w-full"};function Pl(i,n,l,e,c,a){return r(),u("div",Tl,[(r(!0),u(N,null,S(l.tree,o=>(r(),F(e.FileTreeViewItem,{item:o,level:1,modelValue:e.choices,"onUpdate:modelValue":n[0]||(n[0]=t=>e.choices=t)},null,8,["item","modelValue"]))),256))])}var Hl=v(Vl,[["render",Pl]]);const Ul=p({props:{mediaObject:null,tree:null,handleSubmit:null,errors:null},emits:["update:mediaObject"],setup(i,{expose:n,emit:l}){n();const e=i,c=D({get(){return e.mediaObject},set(o){l("update:mediaObject",o)}}),a={props:e,emit:l,item:c,FileTreeView:Hl,Form:K,TextField:Z};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}}),Al=s("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Mettre \xE0 jour",-1);function Bl(i,n,l,e,c,a){return r(),F(e.Form,{onSubmit:l.handleSubmit,class:"flex flex-row flex-wrap","initial-values":e.item},{default:w(({values:o,errors:t})=>[m(e.TextField,{name:"uniqueId",error:t.uniqueId,value:o.uniqueId,label:"Identifiant unique",class:"w-full","field-attrs":{disabled:"disabled"}},null,8,["error","value"]),m(e.TextField,{name:"customName",error:t.customName,value:o.customName,label:"Nom personnalis\xE9",class:"w-full"},null,8,["error","value"]),m(e.FileTreeView,{tree:l.tree,name:"mediaNodes",value:o.mediaNodes},null,8,["tree","value"]),Al]),_:1},8,["onSubmit","initial-values"])}var Rl=v(Ul,[["render",Bl]]);const ql=p({props:{mediaObject:null},async setup(i,{expose:n}){n();let l,e;const c=i,a=R("closeDetailPanel"),o=J({},c.mediaObject),t=P(),d=T(),f=X();[l,e]=W(async()=>Y("media-node-tree",async()=>{await t.fetchTree()})),await l,e();const h=async k=>{await d.update(k.uniqueId,k)};q(()=>d[E.EDITION].edited,k=>{!k||f.showMessage("Fichier mis \xE0 jour")});const x={props:c,closeDetailPanel:a,item:o,mediaNodeStore:t,mediaObjectStore:d,notificationStore:f,onSendForm:h,FileDetailsForm:Rl,Icon:I,CRUD_MODE:E};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),Ll={class:"flex flex-col"},zl={class:"flex flex-row"},$l=s("h2",{class:"mb-3"},"D\xE9tail du fichier",-1);function Gl(i,n,l,e,c,a){return r(),u("div",Ll,[s("div",zl,[$l,m(e.Icon,{icon:"ri-close-line",class:"h-6 w-6 rounded-md fill-primary justify-self-end",onClick:e.closeDetailPanel},null,8,["onClick"])]),s("div",null,[m(e.FileDetailsForm,{tree:e.mediaNodeStore.tree,mediaObject:e.item,"onUpdate:mediaObject":n[0]||(n[0]=o=>e.item=o),"handle-submit":e.onSendForm,errors:e.mediaObjectStore[e.CRUD_MODE.EDITION].violations},null,8,["tree","errors"])])])}var Jl=v(ql,[["render",Gl]]);const Ql=p({props:{showSelection:{type:Boolean,default:!0}},setup(i,{expose:n}){const l=i,e=X(),c=T(),a=P(),o=g(!1),t=g(null),d=g([]),f=g([]),h=g(null),x=g(null);Q("closeDetailPanel",()=>{o.value=!1,t.value=null}),Q("selectionEnabled",l.showSelection);const k=()=>{f.value=[],d.value=[]},H=_=>{_.isImage?O(_):M(_)},O=_=>{f.value.push({src:_.contentUrl})},M=_=>{d.value.push({src:_.contentUrl,name:_.filePath})},b=_=>{f.value.splice(_,1)},ee=_=>{d.value.splice(_,1)},le=_=>{if(!!h.value)for(let y=0;y<_.length;y++){const U=_[y],A=new FormData;A.append("file",U),A.append("mediaNodeId",h.value.id.toString()),c.create(A).then(B=>{var z;B.isImage?O(B):M(B),(z=x.value)==null||z.refresh()})}},ne=_=>{o.value=!0,t.value=_},oe=async _=>{var y;try{await c.remove(_.uniqueId),(y=x.value)==null||y.refresh(),e.showMessage("Media correctement supprim\xE9")}catch{e.showError("Erreur dans la suppression du m\xE9dia")}},te=async _=>{var y;try{await a.remove(_.id),h.value=null,(y=x.value)==null||y.refresh(h.value),e.showMessage("Dossier correctement supprim\xE9")}catch{e.showError("Erreur dans la suppression du dossier")}};n({links:d,thumbnails:f,reset:k});const L={props:l,notificationStore:e,mediaObjectStore:c,mediaNodeStore:a,detailsPanel:o,selectedMediaObject:t,links:d,thumbnails:f,currentMediaNode:h,fileNavigator:x,reset:k,selectMediaObject:H,selectImage:O,selectLink:M,removeThumbnail:b,removeLink:ee,handleUpload:le,editMediaObject:ne,removeMediaObject:oe,removeFolderClickHandler:te,FileSelection:Ee,FileUploader:He,FileNavigator:Ol,FileDetails:Jl};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),Kl={class:"flex flex-row"},Wl={class:"flex flex-col flex-auto"},Xl={key:0,class:"flex w-1/3"};function Yl(i,n,l,e,c,a){return r(),u("div",Kl,[s("div",Wl,[l.showSelection?(r(),F(e.FileSelection,{key:0,thumbnails:e.thumbnails,links:e.links,"remove-link":e.removeLink,"remove-thumbnail":e.removeThumbnail},null,8,["thumbnails","links"])):C("",!0),m(e.FileNavigator,{ref:"fileNavigator","select-click-handler":e.selectMediaObject,"edit-click-handler":e.editMediaObject,"remove-click-handler":e.removeMediaObject,"remove-folder-click-handler":e.removeFolderClickHandler,"show-selection":l.showSelection,modelValue:e.currentMediaNode,"onUpdate:modelValue":n[0]||(n[0]=o=>e.currentMediaNode=o)},null,8,["show-selection","modelValue"]),e.currentMediaNode?(r(),F(e.FileUploader,{key:1,"handle-upload":e.handleUpload})):C("",!0)]),e.detailsPanel?(r(),u("div",Xl,[m(e.FileDetails,{"media-object":e.selectedMediaObject},null,8,["media-object"])])):C("",!0)])}var an=v(Ql,[["render",Yl]]);export{an as F};
