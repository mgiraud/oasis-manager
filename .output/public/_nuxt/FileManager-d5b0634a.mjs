var Ne=Object.defineProperty,Oe=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var pe=(i,a,t)=>a in i?Ne(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t,M=(i,a)=>{for(var t in a||(a={}))Ee.call(a,t)&&pe(i,t,a[t]);if(ve)for(var t of ve(a))je.call(a,t)&&pe(i,t,a[t]);return i},Z=(i,a)=>Oe(i,Fe(a));import{d as P,h as S,i as E,N as Q,S as K,Q as de,y as Ie,_ as j,o as d,c as v,j as u,F as V,k as H,b as x,g as W,t as L,f as B,ag as te,P as De,z as ue,e as R,w as D,H as oe,I as me,p as _e,C as ie,r as Me,U as Te,ah as Ve,n as He,E as Be,q as he}from"./entry-63f3c6e5.mjs";import{I as X}from"./Icon-6e6283c1.mjs";import{u as be}from"./asyncData-2ab7c675.mjs";import{t as se,e as ne,c as Ue,u as fe,l as J,a as _,g as $e,k as Y,p as xe,m as ee,H as q,d as $,o as T,L as re,T as ce,S as Le,b as Re}from"./use-outside-click-aa42c4c8.mjs";import{b as Ae,f as qe,o as Ge}from"./transition-25b36fbb.mjs";import{r as le,M as Ke,j as ze,A as Qe}from"./dialog-c1d3e695.mjs";import{T as ye}from"./TextField-69fdc5c3.mjs";var We=(i=>(i[i.Open=0]="Open",i[i.Closed=1]="Closed",i))(We||{});let ke=Symbol("PopoverContext");function ae(i){let a=K(ke,null);if(a===null){let t=new Error(`<${i} /> is missing a parent <${Se.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,ae),t}return a}let ge=Symbol("PopoverGroupContext");function we(){return K(ge,null)}let Ce=Symbol("PopoverPanelContext");function Xe(){return K(Ce,null)}let Se=P({name:"Popover",props:{as:{type:[Object,String],default:"div"}},setup(i,{slots:a,attrs:t,expose:e}){var s;let o=`headlessui-popover-button-${se()}`,n=`headlessui-popover-panel-${se()}`,l=S(null);e({el:l,$el:l});let r=S(1),f=S(null),h=S(null),k=E(()=>ne(l)),c={popoverState:r,buttonId:o,panelId:n,panel:h,button:f,togglePopover(){r.value=fe(r.value,{[0]:1,[1]:0})},closePopover(){r.value!==1&&(r.value=1)},close(g){c.closePopover();let p=(()=>g?g instanceof HTMLElement?g:g.value instanceof HTMLElement?_(g):_(c.button):_(c.button))();p==null||p.focus()}};Q(ke,c),Ue(E(()=>fe(r.value,{[0]:J.Open,[1]:J.Closed})));let m={buttonId:o,panelId:n,close(){c.closePopover()}},y=we(),N=y==null?void 0:y.registerPopover;function C(){var g,p,w,O;return(O=y==null?void 0:y.isFocusWithinPopoverGroup())!=null?O:((g=k.value)==null?void 0:g.activeElement)&&(((p=_(f))==null?void 0:p.contains(k.value.activeElement))||((w=_(h))==null?void 0:w.contains(k.value.activeElement)))}return de(()=>N==null?void 0:N(m)),le((s=k.value)==null?void 0:s.defaultView,"focus",()=>{r.value===0&&(C()||!f||!h||c.closePopover())},!0),$e([f,h],(g,p)=>{var w;r.value===0&&(c.closePopover(),Le(p,Re.Loose)||(g.preventDefault(),(w=_(f))==null||w.focus()))}),()=>{let g={open:r.value===0,close:c.close};return Y({props:Z(M({},i),{ref:l}),slot:g,slots:a,attrs:t,name:"Popover"})}}}),Ye=P({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(i,{attrs:a,slots:t,expose:e}){var s;let o=ae("PopoverButton"),n=E(()=>ne(o.button));e({el:o.button,$el:o.button});let l=we(),r=l==null?void 0:l.closeOthers,f=Xe(),h=f===null?!1:f===o.panelId,k=S(null),c=S();le((s=n.value)==null?void 0:s.defaultView,"focus",()=>{var p;c.value=k.value,k.value=(p=n.value)==null?void 0:p.activeElement},!0);let m=S(null);h||de(()=>{o.button.value=m.value});let y=Ae(E(()=>({as:i.as,type:a.type})),m);function N(p){var w,O,I,b,F,U,A,G;if(h){if(o.popoverState.value===1)return;switch(p.key){case T.Space:case T.Enter:p.preventDefault(),(O=(w=p.target).click)==null||O.call(w),o.closePopover(),(I=_(o.button))==null||I.focus();break}}else switch(p.key){case T.Space:case T.Enter:p.preventDefault(),p.stopPropagation(),o.popoverState.value===1&&(r==null||r(o.buttonId)),o.togglePopover();break;case T.Escape:if(o.popoverState.value!==0)return r==null?void 0:r(o.buttonId);if(!_(o.button)||((b=n.value)==null?void 0:b.activeElement)&&!((F=_(o.button))!=null&&F.contains(n.value.activeElement)))return;p.preventDefault(),p.stopPropagation(),o.closePopover();break;case T.Tab:if(o.popoverState.value!==0||!o.panel||!o.button)return;if(p.shiftKey){if(!c.value||(U=_(o.button))!=null&&U.contains(c.value)||(A=_(o.panel))!=null&&A.contains(c.value))return;let z=ce((G=n.value)==null?void 0:G.body),Pe=z.indexOf(c.value);if(z.indexOf(_(o.button))>Pe)return;p.preventDefault(),p.stopPropagation(),q(_(o.panel),$.Last)}else p.preventDefault(),p.stopPropagation(),q(_(o.panel),$.First);break}}function C(p){var w,O,I;if(!h&&(p.key===T.Space&&p.preventDefault(),o.popoverState.value===0&&!!o.panel&&!!o.button))switch(p.key){case T.Tab:if(!c.value||(w=_(o.button))!=null&&w.contains(c.value)||(O=_(o.panel))!=null&&O.contains(c.value))return;let b=ce((I=n.value)==null?void 0:I.body),F=b.indexOf(c.value);if(b.indexOf(_(o.button))>F)return;p.preventDefault(),p.stopPropagation(),q(_(o.panel),$.Last);break}}function g(p){var w,O;i.disabled||(h?(o.closePopover(),(w=_(o.button))==null||w.focus()):(p.preventDefault(),p.stopPropagation(),o.popoverState.value===1&&(r==null||r(o.buttonId)),(O=_(o.button))==null||O.focus(),o.togglePopover()))}return()=>{let p={open:o.popoverState.value===0},w=h?{ref:m,type:y.value,onKeydown:N,onClick:g}:{ref:m,id:o.buttonId,type:y.value,"aria-expanded":i.disabled?void 0:o.popoverState.value===0,"aria-controls":_(o.panel)?o.panelId:void 0,disabled:i.disabled?!0:void 0,onKeydown:N,onKeyup:C,onClick:g};return Y({props:M(M({},i),w),slot:p,attrs:a,slots:t,name:"PopoverButton"})}}});P({name:"PopoverOverlay",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(i,{attrs:a,slots:t}){let e=ae("PopoverOverlay"),s=`headlessui-popover-overlay-${se()}`,o=xe(),n=E(()=>o!==null?o.value===J.Open:e.popoverState.value===0);function l(){e.closePopover()}return()=>{let r={open:e.popoverState.value===0};return Y({props:Z(M({},i),{id:s,"aria-hidden":!0,onClick:l}),slot:r,attrs:a,slots:t,features:ee.RenderStrategy|ee.Static,visible:n.value,name:"PopoverOverlay"})}}});let Ze=P({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1}},setup(i,{attrs:a,slots:t,expose:e}){var s,o;let{focus:n}=i,l=ae("PopoverPanel"),r=E(()=>ne(l.panel));e({el:l.panel,$el:l.panel}),Q(Ce,l.panelId),Ie(()=>{l.panel.value=null}),de(()=>{var c,m;if(!n||l.popoverState.value!==0||!l.panel)return;let y=(c=r.value)==null?void 0:c.activeElement;(m=_(l.panel))!=null&&m.contains(y)||q(_(l.panel),$.First)}),le((s=r.value)==null?void 0:s.defaultView,"keydown",c=>{var m,y,N;if(l.popoverState.value!==0||!_(l.panel)||c.key!==T.Tab||!((m=r.value)!=null&&m.activeElement)||!((y=_(l.panel))!=null&&y.contains(r.value.activeElement)))return;c.preventDefault();let C=q(_(l.panel),c.shiftKey?$.Previous:$.Next);if(C===re.Underflow)return(N=_(l.button))==null?void 0:N.focus();if(C===re.Overflow){if(!_(l.button))return;let g=ce(r.value.body),p=g.indexOf(_(l.button)),w=g.splice(p+1).filter(O=>{var I;return!((I=_(l.panel))!=null&&I.contains(O))});q(w,$.First)===re.Error&&q(r.value.body,$.First)}}),le((o=r.value)==null?void 0:o.defaultView,"focus",()=>{var c,m;!n||l.popoverState.value===0&&(!_(l.panel)||((c=r.value)==null?void 0:c.activeElement)&&((m=_(l.panel))==null?void 0:m.contains(r.value.activeElement))||l.closePopover())},!0);let f=xe(),h=E(()=>f!==null?f.value===J.Open:l.popoverState.value===0);function k(c){var m,y;switch(c.key){case T.Escape:if(l.popoverState.value!==0||!_(l.panel)||r.value&&!((m=_(l.panel))!=null&&m.contains(r.value.activeElement)))return;c.preventDefault(),c.stopPropagation(),l.closePopover(),(y=_(l.button))==null||y.focus();break}}return()=>{let c={open:l.popoverState.value===0,close:l.close},m={ref:l.panel,id:l.panelId,onKeydown:k};return Y({props:M(M({},i),m),slot:c,attrs:a,slots:t,features:ee.RenderStrategy|ee.Static,visible:h.value,name:"PopoverPanel"})}}});P({name:"PopoverGroup",props:{as:{type:[Object,String],default:"div"}},setup(i,{attrs:a,slots:t,expose:e}){let s=S(null),o=S([]),n=E(()=>ne(s));e({el:s,$el:s});function l(k){let c=o.value.indexOf(k);c!==-1&&o.value.splice(c,1)}function r(k){return o.value.push(k),()=>{l(k)}}function f(){var k;let c=n.value;if(!c)return!1;let m=c.activeElement;return(k=_(s))!=null&&k.contains(m)?!0:o.value.some(y=>{var N,C;return((N=c.getElementById(y.buttonId))==null?void 0:N.contains(m))||((C=c.getElementById(y.panelId))==null?void 0:C.contains(m))})}function h(k){for(let c of o.value)c.buttonId!==k&&c.close()}return Q(ge,{registerPopover:r,unregisterPopover:l,isFocusWithinPopoverGroup:f,closeOthers:h}),()=>Y({props:Z(M({},i),{ref:s}),slot:{},attrs:a,slots:t,name:"PopoverGroup"})}});const Je=P({props:{thumbnails:null,links:null,removeThumbnail:null,removeLink:null},setup(i,{expose:a}){a();const e={props:i,Icon:X};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),el={class:"flex flex-col"},ll=u("div",{class:"flex-auto"},[u("h3",null,"Fichiers s\xE9lectionn\xE9s")],-1),tl={key:0,class:"flex-auto"},ol=u("p",null," Tu peux t\xE9leverser un fichier ou utiliser le navigateur pour s\xE9lectionner les fichiers \xE0 ins\xE9rer ",-1),nl=[ol],al={key:1,class:"flex flex-auto"},rl={class:"flex flex-col"},il={class:"flex flex-auto"},sl=["src"],cl=["onClick"],dl={class:"flex flex-auto"},ul=["onClick"];function vl(i,a,t,e,s,o){return d(),v("div",el,[ll,t.thumbnails.length+t.links.length===0?(d(),v("div",tl,nl)):(d(),v("div",al,[u("div",rl,[u("div",il,[(d(!0),v(V,null,H(t.thumbnails,(n,l)=>(d(),v("div",{class:"self-center flex-auto",key:l},[u("div",null,[u("img",{src:n.src,class:"max-h-52"},null,8,sl),u("div",null,[u("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:r=>t.removeThumbnail(l)},[x(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,cl)])])]))),128))]),u("div",dl,[(d(!0),v(V,null,H(t.links,(n,l)=>(d(),v("div",{class:"flex-auto",key:l},[u("span",null,[W(L(n.name)+" ",1),u("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:r=>t.removeLink(l)},[x(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,ul)])]))),128))])])]))])}var pl=j(Je,[["render",vl]]);const fl=P({props:{handleUpload:null},setup(i,{expose:a}){a();const t=i,e=S(null),n={props:t,fileSelection:e,openFileSelection:()=>{var l;(l=e.value)==null||l.click()},onFileChange:()=>{var r;const l=(r=e.value)==null?void 0:r.files;l&&t.handleUpload(l)}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),ml={class:"flex flex-col mt-6"};function _l(i,a,t,e,s,o){return d(),v("div",ml,[u("input",{id:"fileElem",ref:"fileSelection",type:"file",multiple:"",accept:"image/*",style:{display:"none"},onChange:e.onFileChange},null,544),u("button",{onClick:e.openFileSelection,class:"bg-primary text-white py-3 px-6 rounded-md w-fit"}," T\xE9l\xE9verser des fichiers ")])}var hl=j(fl,[["render",_l]]);const bl=P({props:{mediaNode:{default:null},mediaNodeClickHandler:null,handleRootClick:null},setup(i,{expose:a}){a();const t=i,s={props:t,handleCrumbClick:o=>{t.mediaNodeClickHandler(o.id)},Icon:X};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),xl={key:0,class:"flex flex-row w-full"},yl=["onClick"],kl=W("\xA0"),gl={class:"cursor-pointer text-primary"};function wl(i,a,t,e,s,o){return t.mediaNode?(d(),v("div",xl,[x(e.Icon,{icon:"ri-home-fill",class:"h-6 w-6 cursor-pointer fill-primary",onClick:t.handleRootClick},null,8,["onClick"]),(d(!0),v(V,null,H(t.mediaNode.breadcrumb,n=>(d(),v("div",{key:n["@id"],onClick:l=>e.handleCrumbClick(n),class:"inline-flex items-center cursor-pointer"},[kl,x(e.Icon,{icon:"ri-arrow-right-s-line",class:"h-6 w-6"}),u("div",gl,L(n.name),1)],8,yl))),128))])):B("",!0)}var Cl=j(bl,[["render",wl]]);const Sl=P({props:{mediaNode:{default:null},handleClick:null},setup(i,{expose:a}){a();const e={props:i};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),Pl={class:"flex flex-row py-3"},Nl=["onClick"];function Ol(i,a,t,e,s,o){return d(),v("div",Pl,[(d(!0),v(V,null,H(t.mediaNode.children,n=>(d(),v("div",{key:n["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary"},[u("button",{onClick:l=>e.props.handleClick(n.id)},L(n.name),9,Nl)]))),128))])}var Fl=j(Sl,[["render",Ol]]);const El=P({props:{mediaNode:{default:null},selectClickHandler:null,editClickHandler:null,removeClickHandler:null},setup(i,{expose:a}){a();const t=i,e=K("selectionEnabled"),s=te(),o=()=>{t.mediaNode&&s.fetchAll({mediaNodes:t.mediaNode.id,"exists[original]":!1})};De(()=>{o()}),ue(()=>t.mediaNode,l=>{o()});const n={props:t,selectionEnabled:e,mediaObjectStore:s,loadObjects:o,Icon:X,Popover:Se,PopoverButton:Ye,PopoverPanel:Ze};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),jl={class:"flex flex-row flex-wrap gap-1"},Il=["src"],Dl={key:1,class:"px-3 py-3 border border-primary"},Ml={class:"bg-gray-100 p-1"},Tl={key:0},Vl={key:1},Hl={class:"flex flex-row bg-gray-100 pb-1"},Bl=W(" Ajouter... "),Ul=["onClick"],$l=["onClick"];function Ll(i,a,t,e,s,o){return d(),v("div",jl,[(d(!0),v(V,null,H(e.mediaObjectStore.list,n=>(d(),v("div",{key:n["@id"],class:"flex flex-col"},[u("div",null,[n.isImage?(d(),v("img",{key:0,src:n.contentUrl,class:"file-navigator-object max-h-80"},null,8,Il)):(d(),v("div",Dl,L(n.filePath),1))]),u("div",Ml,[n.customName?(d(),v("small",Tl,L(n.customName),1)):(d(),v("small",Vl,"Titre non d\xE9fini"))]),u("div",Hl,[e.selectionEnabled?(d(),R(e.Popover,{key:0,class:"relative"},{default:D(()=>[x(e.PopoverButton,{class:"rounded-lg text-sm text-white bg-primary hover:bg-primary-dark h-fit w-fit cursor-pointer py-2 px-3 uppercase"},{default:D(()=>[Bl]),_:1}),x(e.PopoverPanel,{class:"absolute z-10 bg-primary bottom-10 left-2 text-white rounded-lg"},{default:D(()=>[u("div",{class:"w-full cursor-pointer hover:bg-primary-dark px-3 py-2",onClick:l=>t.selectClickHandler(n)},"Original",8,Ul),(d(!0),v(V,null,H(n.thumbnails,l=>(d(),v("div",{class:"w-full cursor-pointer hover:bg-primary-dark px-3 py-2",onClick:r=>t.selectClickHandler(l)},L(l.size),9,$l))),256))]),_:2},1024)]),_:2},1024)):B("",!0),x(e.Icon,{icon:"ri-pencil-line",onClick:l=>t.editClickHandler(n),class:"fill-primary hover:fill-primary-dark h-8 w-8 cursor-pointer"},null,8,["onClick"]),x(e.Icon,{icon:"ri-delete-bin-line",onClick:l=>t.removeClickHandler(n),class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer"},null,8,["onClick"])])]))),128))])}var Rl=j(El,[["render",Ll]]);const Al=P({props:{mediaNode:{default:null},dialog:{type:Boolean},refresh:null},emits:["update:dialog"],setup(i,{expose:a,emit:t}){a();const e=i,s=E({get(){return e.dialog},set(r){t("update:dialog",r)}}),o=oe(),l={props:e,emit:t,show:s,mediaNodeStore:o,onFolderCreate:async r=>{var f;s.value=!1,r.name&&(await o.create({name:r.name,parent:(f=e.mediaNode)==null?void 0:f["@id"]}),await e.refresh())},TransitionRoot:qe,TransitionChild:Ge,Dialog:Ke,DialogPanel:ze,DialogTitle:Qe,Form:me,TextField:ye};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}}),ql=u("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),Gl={class:"fixed inset-0 overflow-y-auto"},Kl={class:"flex min-h-full items-center justify-center p-4 text-center"},zl=W("Ajouter un dossier"),Ql=u("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Cr\xE9er le dossier",-1);function Wl(i,a,t,e,s,o){return d(),R(e.TransitionRoot,{appear:"",show:e.show,as:"template"},{default:D(()=>[x(e.Dialog,{as:"div",open:e.show,onClose:a[0]||(a[0]=n=>e.show=!1),class:"relative z-10"},{default:D(()=>[x(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[ql]),_:1}),u("div",Gl,[u("div",Kl,[x(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[x(e.DialogPanel,{class:"w-full max-w-md transform overflow-hidden rounded-2xl p-6 text-left align-middle shadow-xl transition-all bg-sky-100"},{default:D(()=>[x(e.DialogTitle,{as:"h3"},{default:D(()=>[zl]),_:1}),x(e.Form,{onSubmit:e.onFolderCreate,class:"flex flex-row flex-wrap","validation-schema":{name:"min:3"}},{default:D(({values:n,errors:l})=>[x(e.TextField,{name:"name",error:l.name,value:n.name,label:"Nom du dossier",class:"w-full"},null,8,["error","value"]),Ql]),_:1})]),_:1})]),_:1})])])]),_:1},8,["open"])]),_:1},8,["show"])}var Xl=j(Al,[["render",Wl]]);const Yl=P({props:{editClickHandler:null,selectClickHandler:null,removeClickHandler:null,removeFolderClickHandler:null,modelValue:null,rootName:{default:null}},emits:["update:modelValue"],async setup(i,{expose:a,emit:t}){let e,s;const o=i,n=S(!1),l=E({get(){return o.modelValue},set(C){t("update:modelValue",C)}}),r=oe(),f=te(),h=K("closeDetailPanel"),{refresh:k}=([e,s]=_e(async()=>be("root-media-nodes",async()=>{await r.fetchAll({"exists[parent]":"false"})})),e=await e,s(),e),c=async C=>{f.resetList(),await r.load(C),l.value=r[ie.EDITION].retrieved},m=()=>{l.value=null,h&&h()},y=async C=>{!l.value||C===null?k():(C?await r.load(C.id):await r.load(l.value.id),l.value=r[ie.EDITION].retrieved)};a({refresh:y});const N={props:o,emit:t,folderDialog:n,currentMediaNode:l,mediaNodeStore:r,mediaObjectStore:f,closeDetailPanel:h,getRoots:k,handleMediaNodeClick:c,handleRootClick:m,refresh:y,FileNavigatorBreadCrumb:Cl,FileNavigatorFolders:Fl,FileNavigatorFiles:Rl,FileNavigatorContextMenu:Xl,Icon:X};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}}),Zl={class:"flex flex-col"},Jl=u("div",null,[u("h1",{class:"navigator-title"},"Navigateur de fichier")],-1),et={class:"flex-auto py-2"},lt={key:0,class:"flex-auto flex flex-col"},tt={class:"flex flex-row h-16 items-center gap-x-2"},ot=u("h2",null,"Dossiers",-1),nt={key:1},at={key:1,class:"flex-auto"},rt=u("div",{class:"py-2"},[u("h2",null,"Fichiers")],-1),it={key:2,class:"flex-auto flex flex-col"},st={class:"flex flex-row h-16 items-center gap-x-2"},ct=u("h2",null,"S\xE9lectionner un dossier",-1),dt={class:"flex flex-row"},ut=["onClick"];function vt(i,a,t,e,s,o){return d(),v("div",Zl,[Jl,u("div",et,[x(e.FileNavigatorBreadCrumb,{"media-node":e.props.modelValue,"media-node-click-handler":e.handleMediaNodeClick,"handle-root-click":e.handleRootClick},null,8,["media-node"])]),e.currentMediaNode?(d(),v("div",lt,[u("div",tt,[ot,x(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:a[0]||(a[0]=n=>e.folderDialog=!0)}),x(e.Icon,{icon:"ri-delete-bin-line",class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer",onClick:a[1]||(a[1]=n=>t.removeFolderClickHandler(e.currentMediaNode))})]),e.currentMediaNode.children.length>0?(d(),R(e.FileNavigatorFolders,{key:0,"media-node":e.currentMediaNode,"handle-click":e.handleMediaNodeClick},null,8,["media-node"])):(d(),v("p",nt," Aucun dossier "))])):B("",!0),e.currentMediaNode&&e.currentMediaNode.mediaObjects.length>0?(d(),v("div",at,[rt,u("div",null,[x(e.FileNavigatorFiles,{"select-click-handler":e.props.selectClickHandler,"edit-click-handler":e.props.editClickHandler,"remove-click-handler":e.props.removeClickHandler,"media-node":e.currentMediaNode},null,8,["select-click-handler","edit-click-handler","remove-click-handler","media-node"])])])):B("",!0),e.currentMediaNode?B("",!0):(d(),v("div",it,[u("div",st,[ct,x(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:a[2]||(a[2]=n=>e.folderDialog=!0)})]),u("div",dt,[(d(!0),v(V,null,H(e.mediaNodeStore.list,n=>(d(),v("div",{key:n["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary cursor-pointer",onClick:l=>e.handleMediaNodeClick(n.id)},L(n.name),9,ut))),128))])])),x(e.FileNavigatorContextMenu,{"media-node":e.props.modelValue,refresh:e.refresh,dialog:e.folderDialog,"onUpdate:dialog":a[3]||(a[3]=n=>e.folderDialog=n)},null,8,["media-node","dialog"])])}var pt=j(Yl,[["render",vt]]);const ft=P({props:{item:null,level:null,modelValue:null},emits:["update:modelValue"],setup(i,{expose:a,emit:t}){a();const e=i,s=E(()=>e.context.tree),o=E({get(){return e.modelValue},set(f){t("update:modelValue",f)}}),n=E(()=>o.value.indexOf(e.item["@id"])!==-1);function l(f){f.target.checked?o.value=[...o.value,f.target.value]:o.value=o.value.filter(h=>h!==f.target.value)}const r={props:e,items:s,emit:t,ids:o,isChecked:n,onChange:l};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),mt=["value"];function _t(i,a,t,e,s,o){const n=Me("FileTreeViewItem",!0);return d(),v("div",{class:He(`pl-${t.level*2}`)},[Te(u("input",{type:"checkbox",value:t.item["@id"],onChange:e.onChange,"onUpdate:modelValue":a[0]||(a[0]=l=>e.isChecked=l),class:"ring-primary text-primary border-0 rounded-md focus:ring-0"},null,40,mt),[[Ve,e.isChecked]]),W(" "+L(t.item.name)+" ",1),t.item.children.length>0?(d(!0),v(V,{key:0},H(t.item.children,l=>(d(),R(n,{item:l,level:t.level+1,modelValue:e.ids,"onUpdate:modelValue":a[1]||(a[1]=r=>e.ids=r)},null,8,["item","level","modelValue"]))),256)):B("",!0)],2)}var ht=j(ft,[["render",_t]]);const bt=P({props:{name:null,tree:null,value:null},setup(i,{expose:a}){a();const t=i,{value:e,errorMessage:s,handleBlur:o,handleChange:n,meta:l}=Be(t.name,void 0,{initialValue:t.value}),r=S(t.value?[...t.value]:[]);ue(r,h=>{e.value=h});const f={props:t,inputValue:e,errorMessage:s,handleBlur:o,handleChange:n,meta:l,choices:r,FileTreeViewItem:ht};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),xt={class:"flex flex-col w-full"};function yt(i,a,t,e,s,o){return d(),v("div",xt,[(d(!0),v(V,null,H(t.tree,n=>(d(),R(e.FileTreeViewItem,{item:n,level:1,modelValue:e.choices,"onUpdate:modelValue":a[0]||(a[0]=l=>e.choices=l)},null,8,["item","modelValue"]))),256))])}var kt=j(bt,[["render",yt]]);const gt=P({props:{mediaObject:null,tree:null,handleSubmit:null,errors:null},emits:["update:mediaObject"],setup(i,{expose:a,emit:t}){a();const e=i,s=E({get(){return e.mediaObject},set(n){t("update:mediaObject",n)}}),o={props:e,emit:t,item:s,FileTreeView:kt,Form:me,TextField:ye};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),wt=u("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Mettre \xE0 jour",-1);function Ct(i,a,t,e,s,o){return d(),R(e.Form,{onSubmit:t.handleSubmit,class:"flex flex-row flex-wrap","initial-values":e.item},{default:D(({values:n,errors:l})=>[x(e.TextField,{name:"uniqueId",error:l.uniqueId,value:n.uniqueId,label:"Identifiant unique",class:"w-full","field-attrs":{disabled:"disabled"}},null,8,["error","value"]),x(e.TextField,{name:"customName",error:l.customName,value:n.customName,label:"Nom personnalis\xE9",class:"w-full"},null,8,["error","value"]),x(e.FileTreeView,{tree:t.tree,name:"mediaNodes",value:n.mediaNodes},null,8,["tree","value"]),wt]),_:1},8,["onSubmit","initial-values"])}var St=j(gt,[["render",Ct]]);const Pt=P({props:{mediaObject:null,removeClickHandler:null},async setup(i,{expose:a}){a();let t,e;const s=i,o=K("closeDetailPanel"),n=S(M({},s.mediaObject)),l=oe(),r=te(),f=he();[t,e]=_e(async()=>be("media-node-tree",async()=>{await l.fetchTree()})),await t,e();const h=async m=>{try{await r.update(m.uniqueId,m),f.showMessage("Fichier mis \xE0 jour")}catch{f.showError("Probl\xE8me lors de la mise \xE0 jour du fichier")}},k=async m=>{const y=await r.generateThumbnails(m);n.value=y};ue(()=>s.mediaObject,m=>{m&&(n.value=M({},m))});const c={props:s,closeDetailPanel:o,item:n,mediaNodeStore:l,mediaObjectStore:r,notificationStore:f,onSendForm:h,generateThumbnails:k,FileDetailsForm:St,Icon:X,CRUD_MODE:ie};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),Nt={class:"flex flex-col"},Ot={class:"flex flex-row"},Ft=u("h2",{class:"mb-3"},"D\xE9tail du fichier",-1),Et={class:"flex flex-col px-2"},jt=u("h2",{class:"py-2"},"Miniatures",-1),It={class:"flex flex-col"},Dt=["src","alt"],Mt={key:1},Tt=u("p",null,"Aucune miniature",-1),Vt=[Tt];function Ht(i,a,t,e,s,o){return d(),v("div",Nt,[u("div",Ot,[Ft,x(e.Icon,{icon:"ri-close-line",class:"h-6 w-6 rounded-md fill-primary justify-self-end",onClick:e.closeDetailPanel},null,8,["onClick"])]),u("div",null,[x(e.FileDetailsForm,{tree:e.mediaNodeStore.tree,mediaObject:e.item,"onUpdate:mediaObject":a[0]||(a[0]=n=>e.item=n),"handle-submit":e.onSendForm,errors:e.mediaObjectStore[e.CRUD_MODE.EDITION].violations},null,8,["tree","mediaObject","errors"])]),u("div",Et,[jt,e.item.thumbnails.length>0?(d(!0),v(V,{key:0},H(e.item.thumbnails,n=>(d(),v("div",It,[u("img",{src:n.contentUrl,alt:n.customName||n.uniqueId,class:"w-fit h-auto object-scale-down"},null,8,Dt),x(e.Icon,{icon:"ri-delete-bin-line",onClick:l=>t.removeClickHandler(n,!0),class:"fill-secondary hover:fill-accent h-8 w-8 cursor-pointer"},null,8,["onClick"])]))),256)):(d(),v("div",Mt,Vt)),u("div",{class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark cursor-pointer text-center",onClick:a[1]||(a[1]=n=>e.generateThumbnails(e.item))},"G\xE9n\xE9rer les miniatures")])])}var Bt=j(Pt,[["render",Ht]]);const Ut=P({props:{showSelection:{type:Boolean,default:!0}},setup(i,{expose:a}){const t=i,e=he(),s=te(),o=oe(),n=S(null),l=S([]),r=S([]),f=S(null),h=S(null);Q("closeDetailPanel",()=>{n.value=null}),Q("selectionEnabled",t.showSelection);const k=()=>{r.value=[],l.value=[]},c=b=>{b.isImage?m(b):y(b)},m=b=>{var F;r.value.push({src:b.contentUrl,alt:(F=b.customName)!=null?F:b.uniqueId})},y=b=>{l.value.push({src:b.contentUrl,name:b.filePath})},N=b=>{r.value.splice(b,1)},C=b=>{l.value.splice(b,1)},g=b=>{if(!!f.value)for(let F=0;F<b.length;F++){const U=b[F],A=new FormData;A.append("file",U),A.append("mediaNodeId",f.value.id.toString()),s.create(A).then(G=>{var z;G.isImage?m(G):y(G),(z=h.value)==null||z.refresh()})}},p=b=>{n.value=b},w=async(b,F=!1)=>{var U;try{await s.remove(b.uniqueId),(U=h.value)==null||U.refresh(),n.value=null,e.showMessage("Media correctement supprim\xE9")}catch{e.showError("Erreur dans la suppression du m\xE9dia")}},O=async b=>{var F;try{await o.remove(b.id),f.value=null,(F=h.value)==null||F.refresh(f.value),e.showMessage("Dossier correctement supprim\xE9")}catch{e.showError("Erreur dans la suppression du dossier")}};a({links:l,thumbnails:r,reset:k});const I={props:t,notificationStore:e,mediaObjectStore:s,mediaNodeStore:o,selectedMediaObject:n,links:l,thumbnails:r,currentMediaNode:f,fileNavigator:h,reset:k,selectMediaObject:c,selectImage:m,selectLink:y,removeThumbnail:N,removeLink:C,handleUpload:g,editMediaObject:p,removeMediaObject:w,removeFolderClickHandler:O,FileSelection:pl,FileUploader:hl,FileNavigator:pt,FileDetails:Bt};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),$t={class:"flex flex-row"},Lt={class:"flex flex-col flex-auto w-2/3"},Rt={key:0,class:"flex w-1/3"};function At(i,a,t,e,s,o){return d(),v("div",$t,[u("div",Lt,[x(e.FileNavigator,{ref:"fileNavigator","select-click-handler":e.selectMediaObject,"edit-click-handler":e.editMediaObject,"remove-click-handler":e.removeMediaObject,"remove-folder-click-handler":e.removeFolderClickHandler,"show-selection":t.showSelection,modelValue:e.currentMediaNode,"onUpdate:modelValue":a[0]||(a[0]=n=>e.currentMediaNode=n)},null,8,["show-selection","modelValue"]),e.currentMediaNode?(d(),R(e.FileUploader,{key:0,"handle-upload":e.handleUpload})):B("",!0),t.showSelection?(d(),R(e.FileSelection,{key:1,thumbnails:e.thumbnails,links:e.links,"remove-link":e.removeLink,"remove-thumbnail":e.removeThumbnail},null,8,["thumbnails","links"])):B("",!0)]),e.selectedMediaObject?(d(),v("div",Rt,[x(e.FileDetails,{"media-object":e.selectedMediaObject,"remove-click-handler":e.removeMediaObject},null,8,["media-object"])])):B("",!0)])}var Zt=j(Ut,[["render",At]]);export{Zt as F,Se as p,Ze as w,Ye as x};
