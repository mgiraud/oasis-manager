var ee=Object.defineProperty;var q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var z=(i,n,l)=>n in i?ee(i,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[n]=l,G=(i,n)=>{for(var l in n||(n={}))le.call(n,l)&&z(i,l,n[l]);if(q)for(var l of q(n))te.call(n,l)&&z(i,l,n[l]);return i};import{_ as v,d as p,o as a,c as d,k as s,F as g,l as w,b as m,g as T,t as S,h as b,f as k,T as H,i as E,Q as ne,A as B,e as C,j as F,I as R,w as y,J as Q,q as K,C as V,r as oe,V as ie,ag as ae,n as re,G as se,s as ce,O as J}from"./entry-87b30bf9.mjs";import{I as D}from"./Icon-fefadd4a.mjs";import{u as W}from"./asyncData-43007f1d.mjs";import{T as X}from"./TextField-1d5b5a19.mjs";import{f as de,o as ue}from"./transition-3b170868.mjs";import{M as me,j as _e,A as fe}from"./dialog-f5e7a3df.mjs";const he=p({props:{thumbnails:null,links:null,removeThumbnail:null,removeLink:null},setup(i,{expose:n}){n();const e={props:i,Icon:D};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),ve={class:"flex flex-col"},pe=s("div",{class:"flex-auto"},[s("h3",null,"Fichiers s\xE9lectionn\xE9s")],-1),xe={key:0,class:"flex-auto"},be=s("p",null," Tu peux t\xE9leverser un fichier ou utiliser le navigateur pour s\xE9lectionner les fichiers \xE0 ins\xE9rer ",-1),ke=[be],ye={key:1,class:"flex flex-auto"},ge={class:"flex flex-col"},we={class:"flex flex-auto"},Ce=["src"],Ne=["onClick"],Se={class:"flex flex-auto"},Fe=["onClick"];function je(i,n,l,e,c,r){return a(),d("div",ve,[pe,l.thumbnails.length+l.links.length===0?(a(),d("div",xe,ke)):(a(),d("div",ye,[s("div",ge,[s("div",we,[(a(!0),d(g,null,w(l.thumbnails,(t,o)=>(a(),d("div",{class:"self-center flex-auto",key:o},[s("div",null,[s("img",{src:t.src,class:"max-h-52"},null,8,Ce),s("div",null,[s("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:u=>l.removeThumbnail(o)},[m(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,Ne)])])]))),128))]),s("div",Se,[(a(!0),d(g,null,w(l.links,(t,o)=>(a(),d("div",{class:"flex-auto",key:o},[s("span",null,[T(S(t.name)+" ",1),s("button",{class:"btn-remove-thumbnail bg-error h-6 w-16 rounded-lg",onClick:u=>l.removeLink(o)},[m(e.Icon,{icon:"ri-close-line",class:"h-6 w-6"})],8,Fe)])]))),128))])])]))])}var Oe=v(he,[["render",je]]);const De=p({props:{handleUpload:null},setup(i,{expose:n}){n();const l=i,e=b(null),t={props:l,fileSelection:e,openFileSelection:()=>{var o;(o=e.value)==null||o.click()},onFileChange:()=>{var u;const o=(u=e.value)==null?void 0:u.files;o&&l.handleUpload(o)}};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),Me={class:"flex flex-col mt-6"};function Ie(i,n,l,e,c,r){return a(),d("div",Me,[s("input",{id:"fileElem",ref:"fileSelection",type:"file",multiple:"",accept:"image/*",style:{display:"none"},onChange:e.onFileChange},null,544),s("button",{onClick:e.openFileSelection,class:"bg-primary text-white py-3 px-6 rounded-md w-fit"}," T\xE9l\xE9verser des fichiers ")])}var Ve=v(De,[["render",Ie]]);const Te=p({props:{mediaNode:{default:null},mediaNodeClickHandler:null,handleRootClick:null},setup(i,{expose:n}){n();const l=i,c={props:l,handleCrumbClick:r=>{l.mediaNodeClickHandler(r.id)},Icon:D};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),Ee={key:0,class:"flex flex-row w-full"},Pe=["onClick"],Ue=T("\xA0"),Ae={class:"cursor-pointer text-primary"};function He(i,n,l,e,c,r){return l.mediaNode?(a(),d("div",Ee,[m(e.Icon,{icon:"ri-home-fill",class:"h-6 w-6 cursor-pointer fill-primary",onClick:l.handleRootClick},null,8,["onClick"]),(a(!0),d(g,null,w(l.mediaNode.breadcrumb,t=>(a(),d("div",{key:t["@id"],onClick:o=>e.handleCrumbClick(t),class:"inline-flex items-center cursor-pointer"},[Ue,m(e.Icon,{icon:"ri-arrow-right-s-line",class:"h-6 w-6"}),s("div",Ae,S(t.name),1)],8,Pe))),128))])):k("",!0)}var Be=v(Te,[["render",He]]);const Re=p({props:{mediaNode:{default:null},handleClick:null},setup(i,{expose:n}){n();const e={props:i};return Object.defineProperty(e,"__isScriptSetup",{enumerable:!1,value:!0}),e}}),$e={class:"flex flex-row py-3"},Le=["onClick"];function qe(i,n,l,e,c,r){return a(),d("div",$e,[(a(!0),d(g,null,w(l.mediaNode.children,t=>(a(),d("div",{key:t["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary"},[s("button",{onClick:o=>e.props.handleClick(t.id)},S(t.name),9,Le)]))),128))])}var ze=v(Re,[["render",qe]]);const Ge=p({props:{mediaNode:{default:null},selectClickHandler:null,editClickHandler:null},setup(i,{expose:n}){n();const l=i,e=H("selectionEnabled"),c=E(),r=()=>{l.mediaNode&&c.fetchAll({mediaNodes:l.mediaNode.id})};ne(()=>{r()}),B(()=>l.mediaNode,o=>{r()});const t={props:l,selectionEnabled:e,mediaObjectStore:c,loadObjects:r,Icon:D};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),Je={class:"flex flex-row"},Qe=["src"],Ke={key:1,class:"px-3 py-3 border border-primary"},We={key:0},Xe={key:1},Ye={class:"flex flex-row"};function Ze(i,n,l,e,c,r){return a(),d("div",Je,[(a(!0),d(g,null,w(e.mediaObjectStore.list,t=>(a(),d("div",{key:t["@id"],class:"flex flex-col"},[s("div",null,[t.isImage?(a(),d("img",{key:0,src:t.contentUrl,class:"file-navigator-object max-h-80"},null,8,Qe)):(a(),d("div",Ke,S(t.filePath),1))]),s("div",null,[t.customName?(a(),d("span",We,S(t.customName),1)):(a(),d("small",Xe,"Titre non d\xE9fini"))]),s("div",Ye,[e.selectionEnabled?(a(),C(e.Icon,{key:0,icon:"ri-arrow-left-up-line",onClick:o=>l.selectClickHandler(t),class:"fill-primary h-8 w-8 cursor-pointer"},null,8,["onClick"])):k("",!0),m(e.Icon,{icon:"ri-pencil-line",onClick:o=>l.editClickHandler(t),class:"fill-primary-dark h-8 w-8 cursor-pointer"},null,8,["onClick"])])]))),128))])}var el=v(Ge,[["render",Ze]]);const ll=p({props:{mediaNode:{default:null},dialog:{type:Boolean},refresh:null},emits:["update:dialog"],setup(i,{expose:n,emit:l}){n();const e=i,c=F({get(){return e.dialog},set(u){l("update:dialog",u)}}),r=R(),o={props:e,emit:l,show:c,mediaNodeStore:r,onFolderCreate:async u=>{var _;c.value=!1,u.name&&(await r.create({name:u.name,parent:(_=e.mediaNode)==null?void 0:_["@id"]}),await e.refresh())},TransitionRoot:de,TransitionChild:ue,Dialog:me,DialogPanel:_e,DialogTitle:fe,Form:Q,TextField:X};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),tl=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),nl={class:"fixed inset-0 overflow-y-auto"},ol={class:"flex min-h-full items-center justify-center p-4 text-center"},il=T("Ajouter un dossier"),al=s("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Cr\xE9er le dossier",-1);function rl(i,n,l,e,c,r){return a(),C(e.TransitionRoot,{appear:"",show:e.show,as:"template"},{default:y(()=>[m(e.Dialog,{as:"div",open:e.show,onClose:n[0]||(n[0]=t=>e.show=!1),class:"relative z-10"},{default:y(()=>[m(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:y(()=>[tl]),_:1}),s("div",nl,[s("div",ol,[m(e.TransitionChild,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:y(()=>[m(e.DialogPanel,{class:"w-full max-w-md transform overflow-hidden rounded-2xl p-6 text-left align-middle shadow-xl transition-all bg-sky-100"},{default:y(()=>[m(e.DialogTitle,{as:"h3"},{default:y(()=>[il]),_:1}),m(e.Form,{onSubmit:e.onFolderCreate,class:"flex flex-row flex-wrap","validation-schema":{name:"min:3"}},{default:y(({values:t,errors:o})=>[m(e.TextField,{name:"name",error:o.name,value:t.name,label:"Nom du dossier",class:"w-full"},null,8,["error","value"]),al]),_:1})]),_:1})]),_:1})])])]),_:1},8,["open"])]),_:1},8,["show"])}var sl=v(ll,[["render",rl]]);const cl=p({props:{editClickHandler:null,selectClickHandler:null,modelValue:null,rootName:{default:null}},emits:["update:modelValue"],async setup(i,{expose:n,emit:l}){let e,c;const r=i,t=b(!1),o=F({get(){return r.modelValue},set(O){l("update:modelValue",O)}}),u=R(),_=E(),h=H("closeDetailPanel"),{refresh:N}=([e,c]=K(async()=>W("root-media-nodes",async()=>{await u.fetchAll({"exists[parent]":"false"})})),e=await e,c(),e),x=async O=>{_.resetList(),await u.load(O),o.value=u[V.EDITION].retrieved},j=()=>{o.value=null,h&&h()},M=async()=>{o.value?(await u.load(o.value.id),o.value=u[V.EDITION].retrieved):N()};n({refresh:M});const I={props:r,emit:l,folderDialog:t,currentMediaNode:o,mediaNodeStore:u,mediaObjectStore:_,closeDetailPanel:h,getRoots:N,handleMediaNodeClick:x,handleRootClick:j,refresh:M,FileNavigatorBreadCrumb:Be,FileNavigatorFolders:ze,FileNavigatorFiles:el,FileNavigatorContextMenu:sl,Icon:D};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),dl={class:"flex flex-col"},ul=s("div",null,[s("h1",{class:"navigator-title"},"Navigateur de fichier")],-1),ml={class:"flex-auto py-2"},_l={key:0,class:"flex-auto flex flex-col"},fl={class:"flex flex-row h-16 items-center gap-x-2"},hl=s("h2",null,"Dossiers",-1),vl={key:1},pl={key:1,class:"flex-auto"},xl=s("div",null,[s("h2",null,"Fichiers")],-1),bl={key:2,class:"flex-auto flex flex-col"},kl={class:"flex flex-row h-16 items-center gap-x-2"},yl=s("h2",null,"S\xE9lectionner un dossier",-1),gl={class:"flex flex-row"},wl=["onClick"];function Cl(i,n,l,e,c,r){return a(),d("div",dl,[ul,s("div",ml,[m(e.FileNavigatorBreadCrumb,{"media-node":e.props.modelValue,"media-node-click-handler":e.handleMediaNodeClick,"handle-root-click":e.handleRootClick},null,8,["media-node"])]),e.currentMediaNode?(a(),d("div",_l,[s("div",fl,[hl,m(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:n[0]||(n[0]=t=>e.folderDialog=!0)})]),e.currentMediaNode.children.length>0?(a(),C(e.FileNavigatorFolders,{key:0,"media-node":e.currentMediaNode,"handle-click":e.handleMediaNodeClick},null,8,["media-node"])):(a(),d("p",vl," Aucun dossier "))])):k("",!0),e.currentMediaNode&&e.currentMediaNode.mediaObjects.length>0?(a(),d("div",pl,[xl,s("div",null,[m(e.FileNavigatorFiles,{"select-click-handler":e.props.selectClickHandler,"edit-click-handler":e.props.editClickHandler,"media-node":e.currentMediaNode},null,8,["select-click-handler","edit-click-handler","media-node"])])])):k("",!0),e.currentMediaNode?k("",!0):(a(),d("div",bl,[s("div",kl,[yl,m(e.Icon,{icon:"ri-folder-add-line",class:"fill-primary h-8 w-8 cursor-pointer",onClick:n[1]||(n[1]=t=>e.folderDialog=!0)})]),s("div",gl,[(a(!0),d(g,null,w(e.mediaNodeStore.list,t=>(a(),d("div",{key:t["@id"],class:"w-fit p-3 bg-primary-dark text-white ml-2 first:ml-0 rounded-md hover:bg-primary cursor-pointer",onClick:o=>e.handleMediaNodeClick(t.id)},S(t.name),9,wl))),128))])])),m(e.FileNavigatorContextMenu,{"media-node":e.props.modelValue,refresh:e.refresh,dialog:e.folderDialog,"onUpdate:dialog":n[2]||(n[2]=t=>e.folderDialog=t)},null,8,["media-node","dialog"])])}var Nl=v(cl,[["render",Cl]]);const Sl=p({props:{item:null,level:null,modelValue:null},emits:["update:modelValue"],setup(i,{expose:n,emit:l}){n();const e=i,c=F(()=>e.context.tree),r=F({get(){return e.modelValue},set(_){l("update:modelValue",_)}}),t=F(()=>r.value.indexOf(e.item["@id"])!==-1);function o(_){_.target.checked?r.value=[...r.value,_.target.value]:r.value=r.value.filter(h=>h!==_.target.value)}const u={props:e,items:c,emit:l,ids:r,isChecked:t,onChange:o};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),Fl=["value"];function jl(i,n,l,e,c,r){const t=oe("FileTreeViewItem",!0);return a(),d("div",{class:re(`pl-${l.level*2}`)},[ie(s("input",{type:"checkbox",value:l.item["@id"],onChange:e.onChange,"onUpdate:modelValue":n[0]||(n[0]=o=>e.isChecked=o),class:"ring-primary text-primary border-0 rounded-md focus:ring-0"},null,40,Fl),[[ae,e.isChecked]]),T(" "+S(l.item.name)+" ",1),l.item.children.length>0?(a(!0),d(g,{key:0},w(l.item.children,o=>(a(),C(t,{item:o,level:l.level+1,modelValue:e.ids,"onUpdate:modelValue":n[1]||(n[1]=u=>e.ids=u)},null,8,["item","level","modelValue"]))),256)):k("",!0)],2)}var Ol=v(Sl,[["render",jl]]);const Dl=p({props:{name:null,tree:null,value:null},setup(i,{expose:n}){n();const l=i,{value:e,errorMessage:c,handleBlur:r,handleChange:t,meta:o}=se(l.name,void 0,{initialValue:l.value}),u=b(l.value?[...l.value]:[]);B(u,h=>{e.value=h});const _={props:l,inputValue:e,errorMessage:c,handleBlur:r,handleChange:t,meta:o,choices:u,FileTreeViewItem:Ol};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),Ml={class:"flex flex-col w-full"};function Il(i,n,l,e,c,r){return a(),d("div",Ml,[(a(!0),d(g,null,w(l.tree,t=>(a(),C(e.FileTreeViewItem,{item:t,level:1,modelValue:e.choices,"onUpdate:modelValue":n[0]||(n[0]=o=>e.choices=o)},null,8,["item","modelValue"]))),256))])}var Vl=v(Dl,[["render",Il]]);const Tl=p({props:{mediaObject:null,tree:null,handleSubmit:null,errors:null},emits:["update:mediaObject"],setup(i,{expose:n,emit:l}){n();const e=i,c=F({get(){return e.mediaObject},set(t){l("update:mediaObject",t)}}),r={props:e,emit:l,item:c,FileTreeView:Vl,Form:Q,TextField:X};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),El=s("button",{type:"submit",class:"py-3 px-4 bg-primary text-white shadow-md uppercase hover:bg-primary-dark"},"Mettre \xE0 jour",-1);function Pl(i,n,l,e,c,r){return a(),C(e.Form,{onSubmit:l.handleSubmit,class:"flex flex-row flex-wrap","initial-values":e.item},{default:y(({values:t,errors:o})=>[m(e.TextField,{name:"uniqueId",error:o.uniqueId,value:t.uniqueId,label:"Identifiant unique",class:"w-full","field-attrs":{disabled:"disabled"}},null,8,["error","value"]),m(e.TextField,{name:"customName",error:o.customName,value:t.customName,label:"Nom personnalis\xE9",class:"w-full"},null,8,["error","value"]),m(e.FileTreeView,{tree:l.tree,name:"mediaNodes",value:t.mediaNodes},null,8,["tree","value"]),El]),_:1},8,["onSubmit","initial-values"])}var Ul=v(Tl,[["render",Pl]]);const Al=p({props:{mediaObject:null},async setup(i,{expose:n}){n();let l,e;const c=i,r=H("closeDetailPanel"),t=G({},c.mediaObject),o=R(),u=E(),_=ce();[l,e]=K(async()=>W("media-node-tree",async()=>{await o.fetchTree()})),await l,e();const h=async x=>{await u.update(x.uniqueId,x)};B(()=>u[V.EDITION].edited,x=>{!x||_.showMessage("Fichier mis \xE0 jour")});const N={props:c,closeDetailPanel:r,item:t,mediaNodeStore:o,mediaObjectStore:u,notificationStore:_,onSendForm:h,FileDetailsForm:Ul,Icon:D,CRUD_MODE:V};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}}),Hl={class:"flex flex-col"},Bl={class:"flex flex-row"},Rl=s("h2",{class:"mb-3"},"D\xE9tail du fichier",-1);function $l(i,n,l,e,c,r){return a(),d("div",Hl,[s("div",Bl,[Rl,m(e.Icon,{icon:"ri-close-line",class:"h-6 w-6 rounded-md fill-primary justify-self-end",onClick:e.closeDetailPanel},null,8,["onClick"])]),s("div",null,[m(e.FileDetailsForm,{tree:e.mediaNodeStore.tree,mediaObject:e.item,"onUpdate:mediaObject":n[0]||(n[0]=t=>e.item=t),"handle-submit":e.onSendForm,errors:e.mediaObjectStore[e.CRUD_MODE.EDITION].violations},null,8,["tree","errors"])])])}var Ll=v(Al,[["render",$l]]);const ql=p({props:{showSelection:{type:Boolean,default:!0}},setup(i,{expose:n}){const l=i,e=E(),c=b(!1),r=b(null),t=b([]),o=b([]),u=b(null),_=b(null);J("closeDetailPanel",()=>{c.value=!1,r.value=null}),J("selectionEnabled",l.showSelection);const h=()=>{o.value=[],t.value=[]},N=f=>{f.isImage?x(f):j(f)},x=f=>{o.value.push({src:f.contentUrl})},j=f=>{t.value.push({src:f.contentUrl,name:f.filePath})},M=f=>{o.value.splice(f,1)},I=f=>{t.value.splice(f,1)},O=f=>{if(!!u.value)for(let P=0;P<f.length;P++){const Z=f[P],U=new FormData;U.append("file",Z),U.append("mediaNodeId",u.value.id.toString()),e.create(U).then(A=>{var L;A.isImage?x(A):j(A),(L=_.value)==null||L.refresh()})}},Y=f=>{c.value=!0,r.value=f};n({links:t,thumbnails:o,reset:h});const $={props:l,mediaObjectStore:e,detailsPanel:c,selectedMediaObject:r,links:t,thumbnails:o,currentMediaNode:u,fileNavigator:_,reset:h,selectMediaObject:N,selectImage:x,selectLink:j,removeThumbnail:M,removeLink:I,handleUpload:O,editMediaObject:Y,FileSelection:Oe,FileUploader:Ve,FileNavigator:Nl,FileDetails:Ll};return Object.defineProperty($,"__isScriptSetup",{enumerable:!1,value:!0}),$}}),zl={class:"flex flex-row"},Gl={class:"flex flex-col flex-auto"},Jl={key:0,class:"flex w-1/3"};function Ql(i,n,l,e,c,r){return a(),d("div",zl,[s("div",Gl,[l.showSelection?(a(),C(e.FileSelection,{key:0,thumbnails:e.thumbnails,links:e.links,"remove-link":e.removeLink,"remove-thumbnail":e.removeThumbnail},null,8,["thumbnails","links"])):k("",!0),m(e.FileNavigator,{ref:"fileNavigator","select-click-handler":e.selectMediaObject,"edit-click-handler":e.editMediaObject,"show-selection":l.showSelection,modelValue:e.currentMediaNode,"onUpdate:modelValue":n[0]||(n[0]=t=>e.currentMediaNode=t)},null,8,["show-selection","modelValue"]),e.currentMediaNode?(a(),C(e.FileUploader,{key:1,"handle-upload":e.handleUpload})):k("",!0)]),e.detailsPanel?(a(),d("div",Jl,[m(e.FileDetails,{"media-object":e.selectedMediaObject},null,8,["media-object"])])):k("",!0)])}var tt=v(ql,[["render",Ql]]);export{tt as F};
